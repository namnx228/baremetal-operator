---
---
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  name: selfsigned-issuer
  namespace: ${NAMEPREFIX}-system
spec:
  selfSigned: {}
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: ironic-cacert
  namespace: ${NAMEPREFIX}-system
spec:
  commonName: ironic-ca
  isCA: true
  ipAddresses:
  - IRONIC_HOST_IP
  issuerRef:
    kind: Issuer
    name: selfsigned-issuer
  secretName: ironic-cacert
---
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  name: ca-issuer
  namespace: ${NAMEPREFIX}-system
spec:
  ca:
    secretName: ironic-cacert
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: ironic-cert
  namespace: ${NAMEPREFIX}-system
spec:
  commonName: ironic-cert
  ipAddresses:
  - IRONIC_HOST_IP
  issuerRef:
    kind: Issuer
    name: ca-issuer
  secretName: ironic-cert
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: ironic-inspector-cert
  namespace: ${NAMEPREFIX}-system
spec:
  commonName: ironic-inspector-cert
  ipAddresses:
  - IRONIC_HOST_IP
  issuerRef:
    kind: Issuer
    name: ca-issuer
  secretName: ironic-inspector-cert
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: mariadb-cert
  namespace: ${NAMEPREFIX}-system
spec:
  commonName: mariadb-cert
  ipAddresses:
  - MARIADB_HOST_IP
  issuerRef:
    kind: Issuer
    name: ca-issuer
  secretName: mariadb-cert
---
resources:
- certificate.yaml
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: ${NAMEPREFIX}-system
resources:
- ../ironic
configMapGenerator:
- envs:
  - ironic_bmo_configmap.env
  name: ironic-bmo-configmap
secretGenerator:
- literals:
  - password=changeme
  name: mariadb-password
  type: Opaque---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ${NAMEPREFIX}-ironic
spec:
  replicas: 1
  strategy:
    # We cannot run Ironic with more than one replica at a time. The recreate
    # strategy makes sure that the old pod is gone before a new is started.
    type: Recreate
  selector:
    matchLabels:
      name: ${NAMEPREFIX}-ironic
  template:
    metadata:
      labels:
        name: ${NAMEPREFIX}-ironic
    spec:
      hostNetwork: true
      containers:
        - name: ironic-dnsmasq
          image: quay.io/metal3-io/ironic
          imagePullPolicy: Always
          securityContext:
             capabilities:
               add: ["NET_ADMIN"]
          command:
            - /bin/rundnsmasq
          livenessProbe:
           exec:
             command: ["sh", "-c", "ss -lun | grep :67 && ss -lun | grep :69"]
           initialDelaySeconds: 30
           periodSeconds: 30
           timeoutSeconds: 10
           successThreshold: 1
           failureThreshold: 10
          readinessProbe:
           exec:
             command: ["sh", "-c", "ss -lun | grep :67 && ss -lun | grep :69"]
           initialDelaySeconds: 30
           periodSeconds: 30
           timeoutSeconds: 10
           successThreshold: 1
           failureThreshold: 10
          volumeMounts:
            - mountPath: /shared
              name: ironic-data-volume
          envFrom:
            - configMapRef:
                name: ironic-bmo-configmap
        - name: mariadb
          image: quay.io/metal3-io/mariadb
          imagePullPolicy: Always
          livenessProbe:
           exec:
             command: ["sh", "-c", "mysqladmin status -uironic -p$(printenv MARIADB_PASSWORD)"]
           initialDelaySeconds: 30
           periodSeconds: 30
           timeoutSeconds: 10
           successThreshold: 1
           failureThreshold: 10
          readinessProbe:
           exec:
             command: ["sh", "-c", "mysqladmin status -uironic -p$(printenv MARIADB_PASSWORD)"]
           initialDelaySeconds: 30
           periodSeconds: 30
           timeoutSeconds: 10
           successThreshold: 1
           failureThreshold: 10
          volumeMounts:
            - mountPath: /shared
              name: ironic-data-volume
          env:
            - name: MARIADB_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mariadb-password
                  key: password
            - name: RESTART_CONTAINER_CERTIFICATE_UPDATED
              valueFrom:
                 configMapKeyRef:
                  name: ironic-bmo-configmap
                  key: RESTART_CONTAINER_CERTIFICATE_UPDATED
        - name: ironic
          image: quay.io/metal3-io/ironic
          imagePullPolicy: Always
          command:
            - /bin/runironic
          livenessProbe:
           exec:
             command: ["sh", "-c", "curl -sSf http://127.0.0.1:6385 || curl -sSfk https://127.0.0.1:6385"]
           initialDelaySeconds: 30
           periodSeconds: 30
           timeoutSeconds: 10
           successThreshold: 1
           failureThreshold: 10
          readinessProbe:
           exec:
             command: ["sh", "-c", "curl -sSf http://127.0.0.1:6385 || curl -sSfk https://127.0.0.1:6385"]
           initialDelaySeconds: 30
           periodSeconds: 30
           timeoutSeconds: 10
           successThreshold: 1
           failureThreshold: 10
          volumeMounts:
            - mountPath: /shared
              name: ironic-data-volume
          envFrom:
            - configMapRef:
                name: ironic-bmo-configmap
          env:
            - name: MARIADB_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mariadb-password
                  key: password
        - name: ironic-log-watch
          image: quay.io/metal3-io/ironic
          imagePullPolicy: Always
          command:
            - /bin/runlogwatch.sh
          volumeMounts:
            - mountPath: /shared
              name: ironic-data-volume
        - name: ironic-inspector
          image: quay.io/metal3-io/ironic
          imagePullPolicy: Always
          readinessProbe:
            exec:
              command: ["sh", "-c", "curl -sSf http://127.0.0.1:5050 || curl -sSf -k https://127.0.0.1:5050"]
            initialDelaySeconds: 30
            periodSeconds: 30
            timeoutSeconds: 10
            successThreshold: 1
            failureThreshold: 10
          livenessProbe:
            exec:
              command: ["sh", "-c", "curl -sSf http://127.0.0.1:5050 || curl -sSf -k https://127.0.0.1:5050"]
            initialDelaySeconds: 30
            periodSeconds: 30
            timeoutSeconds: 10
            successThreshold: 1
            failureThreshold: 10
          command:
            - /bin/runironic-inspector
          envFrom:
            - configMapRef:
                name: ironic-bmo-configmap
        - name: ironic-httpd
          image: quay.io/metal3-io/ironic
          imagePullPolicy: Always
          command:
            - /bin/runhttpd
          livenessProbe:
           exec:
             command: ["sh", "-c", "curl -sSfk https://127.0.0.1:6180"]
           initialDelaySeconds: 30
           periodSeconds: 30
           timeoutSeconds: 10
           successThreshold: 1
           failureThreshold: 10
          readinessProbe:
           exec:
             command: ["sh", "-c", "curl -sSfk https://127.0.0.1:6180"]
           initialDelaySeconds: 30
           periodSeconds: 30
           timeoutSeconds: 10
           successThreshold: 1
           failureThreshold: 10
          volumeMounts:
            - mountPath: /shared
              name: ironic-data-volume
          envFrom:
            - configMapRef:
                name: ironic-bmo-configmap
      initContainers:
        - name: ironic-ipa-downloader
          image: quay.io/metal3-io/ironic-ipa-downloader
          imagePullPolicy: Always
          command:
            - /usr/local/bin/get-resource.sh
          envFrom:
            - configMapRef:
                name: ironic-bmo-configmap
          volumeMounts:
            - mountPath: /shared
              name: ironic-data-volume
      volumes:
        - name: ironic-data-volume
          emptyDir: {}
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- ironic.yaml---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ${NAMEPREFIX}-ironic
spec:
  template:
    spec:
      containers:
      # Change the value of image field below to your controller image URL
      - image: quay.io/metal3-io/keepalived
        name: ironic-endpoint-keepalived
        securityContext:
              capabilities:
                add: ["NET_ADMIN", "NET_RAW"]
        envFrom:
          - configMapRef:
              name: ironic-bmo-configmap
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: ${NAMEPREFIX}-system
resources:
- ../../config/namespace
- ../ironic
configMapGenerator:
- envs:
  - ironic_bmo_configmap.env
  name: ironic-bmo-configmap
secretGenerator:
- literals:
  - password=changeme
  name: mariadb-password
  type: Opaque
patchesStrategicMerge:
- keepalived_patch.yaml---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ${NAMEPREFIX}-ironic
spec:
  template:
    spec:
      containers:
      - name: ironic
        readinessProbe:
         exec:
           command: ["sh", "-c", "curl -sSf http://127.0.0.1:6388"]
        livenessProbe:
         exec:
           command: ["sh", "-c", "curl -sSf http://127.0.0.1:6388"]
        env:
        - name: IRONIC_REVERSE_PROXY_SETUP
          value: "true"
        - name: INSPECTOR_REVERSE_PROXY_SETUP
          value: "true"
        volumeMounts:
        - name: cert-ironic-ca
          mountPath: "/certs/ca/ironic"
          readOnly: true
        - name: cert-ironic-inspector-ca
          mountPath: "/certs/ca/ironic-inspector"
          readOnly: true
        - name: cert-mariadb-ca
          mountPath: "/certs/ca/mariadb"
          readOnly: true
      - name: ironic-httpd
        livenessProbe:
         exec:
           command: ["sh", "-c", "curl -sSfk https://127.0.0.1:6385"]
        readinessProbe:
         exec:
           command: ["sh", "-c", "curl -sSfk https://127.0.0.1:6385"]
        env:
        - name: IRONIC_REVERSE_PROXY_SETUP
          value: "true"
        - name: INSPECTOR_REVERSE_PROXY_SETUP
          value: "true"
        volumeMounts:
        - name: cert-ironic
          mountPath: "/certs/ironic"
          readOnly: true
        - name: cert-ironic-inspector
          mountPath: "/certs/ironic-inspector"
          readOnly: true
        - name: cert-ironic-ca
          mountPath: "/certs/ca/ironic"
          readOnly: true
        - name: cert-ironic-inspector-ca
          mountPath: "/certs/ca/ironic-inspector"
          readOnly: true
      - name: ironic-inspector
        readinessProbe:
          exec:
            command: ["sh", "-c", "curl -sSf http://127.0.0.1:5049"]
        livenessProbe:
          exec:
            command: ["sh", "-c", "curl -sSf http://127.0.0.1:5049"]
        env:
        - name: IRONIC_REVERSE_PROXY_SETUP
          value: "true"
        - name: INSPECTOR_REVERSE_PROXY_SETUP
          value: "true"
        volumeMounts:
        - name: cert-ironic-ca
          mountPath: "/certs/ca/ironic"
          readOnly: true
        - name: cert-ironic-inspector-ca
          mountPath: "/certs/ca/ironic-inspector"
          readOnly: true
      - name: mariadb
        volumeMounts:
        - name: cert-mariadb
          mountPath: "/certs/mariadb"
          readOnly: true
        - name: cert-mariadb-ca
          mountPath: "/certs/ca/mariadb"
          readOnly: true
      volumes:
      - name: cert-ironic-ca
        secret:
          secretName: ironic-cacert
      - name: cert-ironic-inspector-ca
        secret:
          secretName: ironic-cacert
      - name: cert-ironic
        secret:
          secretName: ironic-cert
      - name: cert-ironic-inspector
        secret:
          secretName: ironic-inspector-cert
      - name: cert-mariadb
        secret:
          secretName: mariadb-cert
      - name: cert-mariadb-ca
        secret:
          secretName: ironic-cacert
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: ${NAMEPREFIX}-system
resources:
- ../../default
- ../../certmanager

patchesStrategicMerge:
- tls.yaml
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ${NAMEPREFIX}-ironic
spec:
  template:
    spec:
      containers:
      - name: ironic
        readinessProbe:
         exec:
           command: ["sh", "-c", "curl -sSf http://127.0.0.1:6388"]
        livenessProbe:
         exec:
           command: ["sh", "-c", "curl -sSf http://127.0.0.1:6388"]
        env:
        - name: IRONIC_REVERSE_PROXY_SETUP
          value: "true"
        - name: INSPECTOR_REVERSE_PROXY_SETUP
          value: "true"
        volumeMounts:
        - name: cert-ironic-ca
          mountPath: "/certs/ca/ironic"
          readOnly: true
        - name: cert-ironic-inspector-ca
          mountPath: "/certs/ca/ironic-inspector"
          readOnly: true
        - name: cert-mariadb-ca
          mountPath: "/certs/ca/mariadb"
          readOnly: true
      - name: ironic-httpd
        livenessProbe:
         exec:
           command: ["sh", "-c", "curl -sSfk https://127.0.0.1:6385"]
        readinessProbe:
         exec:
           command: ["sh", "-c", "curl -sSfk https://127.0.0.1:6385"]
        env:
        - name: IRONIC_REVERSE_PROXY_SETUP
          value: "true"
        - name: INSPECTOR_REVERSE_PROXY_SETUP
          value: "true"
        volumeMounts:
        - name: cert-ironic
          mountPath: "/certs/ironic"
          readOnly: true
        - name: cert-ironic-inspector
          mountPath: "/certs/ironic-inspector"
          readOnly: true
        - name: cert-ironic-ca
          mountPath: "/certs/ca/ironic"
          readOnly: true
        - name: cert-ironic-inspector-ca
          mountPath: "/certs/ca/ironic-inspector"
          readOnly: true
      - name: ironic-inspector
        readinessProbe:
          exec:
            command: ["sh", "-c", "curl -sSf http://127.0.0.1:5049"]
        livenessProbe:
          exec:
            command: ["sh", "-c", "curl -sSf http://127.0.0.1:5049"]
        env:
        - name: IRONIC_REVERSE_PROXY_SETUP
          value: "true"
        - name: INSPECTOR_REVERSE_PROXY_SETUP
          value: "true"
        volumeMounts:
        - name: cert-ironic-ca
          mountPath: "/certs/ca/ironic"
          readOnly: true
        - name: cert-ironic-inspector-ca
          mountPath: "/certs/ca/ironic-inspector"
          readOnly: true
      - name: mariadb
        volumeMounts:
        - name: cert-mariadb
          mountPath: "/certs/mariadb"
          readOnly: true
        - name: cert-mariadb-ca
          mountPath: "/certs/ca/mariadb"
          readOnly: true
      volumes:
      - name: cert-ironic-ca
        secret:
          secretName: ironic-cacert
      - name: cert-ironic-inspector-ca
        secret:
          secretName: ironic-cacert
      - name: cert-ironic
        secret:
          secretName: ironic-cert
      - name: cert-ironic-inspector
        secret:
          secretName: ironic-inspector-cert
      - name: cert-mariadb
        secret:
          secretName: mariadb-cert
      - name: cert-mariadb-ca
        secret:
          secretName: ironic-cacert
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: ${NAMEPREFIX}-system
resources:
- ../../keepalived
- ../../certmanager

patchesStrategicMerge:
- tls.yaml
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: ${NAMEPREFIX}-system
resources:
- ../../default

configMapGenerator:
- behavior: create
  envs:
  - ironic-htpasswd
  name: ironic-htpasswd
- behavior: create
  envs:
  - ironic-inspector-htpasswd
  name: ironic-inspector-htpasswd

secretGenerator:
- name: ironic-auth-config
  files:
  - auth-config=ironic-auth-config
- name: ironic-inspector-auth-config
  files:
  - auth-config=ironic-inspector-auth-config

patchesStrategicMerge:
- auth.yaml
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ${NAMEPREFIX}-ironic
spec:
  template:
    spec:
      containers:
      - name: ironic
        volumeMounts:
        - name: ironic-auth-config
          mountPath: "/auth/ironic"
          readOnly: true
        - name: ironic-inspector-auth-config
          mountPath: "/auth/ironic-inspector"
          readOnly: true
        envFrom:
        - configMapRef:
            name: ironic-htpasswd
        - configMapRef:
            name: ironic-inspector-htpasswd
        - configMapRef:
            name: ironic-bmo-configmap
      - name: ironic-inspector
        volumeMounts:
        - name: ironic-auth-config
          mountPath: "/auth/ironic"
          readOnly: true
        - name: ironic-inspector-auth-config
          mountPath: "/auth/ironic-inspector"
          readOnly: true
        envFrom:
        - configMapRef:
            name: ironic-htpasswd
        - configMapRef:
            name: ironic-inspector-htpasswd
        - configMapRef:
            name: ironic-bmo-configmap
      volumes:
      - name: ironic-auth-config
        secret:
          secretName: ironic-auth-config
      - name: ironic-inspector-auth-config
        secret:
          secretName: ironic-inspector-auth-config
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: ${NAMEPREFIX}-system
resources:
- ../../keepalived

configMapGenerator:
- behavior: create
  envs:
  - ironic-htpasswd
  name: ironic-htpasswd
- behavior: create
  envs:
  - ironic-inspector-htpasswd
  name: ironic-inspector-htpasswd

secretGenerator:
- name: ironic-auth-config
  files:
  - auth-config=ironic-auth-config
- name: ironic-inspector-auth-config
  files:
  - auth-config=ironic-inspector-auth-config

patchesStrategicMerge:
- auth.yaml
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ${NAMEPREFIX}-ironic
spec:
  template:
    spec:
      containers:
      - name: ironic
        volumeMounts:
        - name: ironic-auth-config
          mountPath: "/auth/ironic"
          readOnly: true
        - name: ironic-inspector-auth-config
          mountPath: "/auth/ironic-inspector"
          readOnly: true
        envFrom:
        - configMapRef:
            name: ironic-htpasswd
        - configMapRef:
            name: ironic-inspector-htpasswd
        - configMapRef:
            name: ironic-bmo-configmap
      - name: ironic-inspector
        volumeMounts:
        - name: ironic-auth-config
          mountPath: "/auth/ironic"
          readOnly: true
        - name: ironic-inspector-auth-config
          mountPath: "/auth/ironic-inspector"
          readOnly: true
        envFrom:
        - configMapRef:
            name: ironic-htpasswd
        - configMapRef:
            name: ironic-inspector-htpasswd
        - configMapRef:
            name: ironic-bmo-configmap
      volumes:
      - name: ironic-auth-config
        secret:
          secretName: ironic-auth-config
      - name: ironic-inspector-auth-config
        secret:
          secretName: ironic-inspector-auth-config
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: ${NAMEPREFIX}-system
resources:
- ../../../tls/default

configMapGenerator:
- behavior: create
  envs:
  - ironic-htpasswd
  name: ironic-htpasswd
- behavior: create
  envs:
  - ironic-inspector-htpasswd
  name: ironic-inspector-htpasswd

secretGenerator:
- name: ironic-auth-config
  files:
  - auth-config=ironic-auth-config
- name: ironic-inspector-auth-config
  files:
  - auth-config=ironic-inspector-auth-config

patchesStrategicMerge:
- auth.yaml
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ${NAMEPREFIX}-ironic
spec:
  template:
    spec:
      containers:
      - name: ironic
        volumeMounts:
        - name: ironic-inspector-auth-config
          mountPath: "/auth/ironic-inspector"
          readOnly: true
        envFrom:
        - configMapRef:
            name: ironic-htpasswd
        - configMapRef:
            name: ironic-bmo-configmap
      - name: ironic-httpd
        volumeMounts:
        - name: ironic-auth-config
          mountPath: "/auth/ironic"
          readOnly: true
        - name: ironic-inspector-auth-config
          mountPath: "/auth/ironic-inspector"
          readOnly: true
        envFrom:
        - configMapRef:
            name: ironic-htpasswd
        - configMapRef:
            name: ironic-inspector-htpasswd
        - configMapRef:
            name: ironic-bmo-configmap
      - name: ironic-inspector
        volumeMounts:
        - name: ironic-auth-config
          mountPath: "/auth/ironic"
          readOnly: true
        envFrom:
        - configMapRef:
            name: ironic-inspector-htpasswd
        - configMapRef:
            name: ironic-bmo-configmap
      volumes:
      - name: ironic-auth-config
        secret:
          secretName: ironic-auth-config
      - name: ironic-inspector-auth-config
        secret:
          secretName: ironic-inspector-auth-config
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: ${NAMEPREFIX}-system
resources:
- ../../../tls/keepalived

configMapGenerator:
- behavior: create
  envs:
  - ironic-htpasswd
  name: ironic-htpasswd
- behavior: create
  envs:
  - ironic-inspector-htpasswd
  name: ironic-inspector-htpasswd

secretGenerator:
- name: ironic-auth-config
  files:
  - auth-config=ironic-auth-config
- name: ironic-inspector-auth-config
  files:
  - auth-config=ironic-inspector-auth-config

patchesStrategicMerge:
- auth.yaml
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ${NAMEPREFIX}-ironic
spec:
  template:
    spec:
      containers:
      - name: ironic
        volumeMounts:
        - name: ironic-inspector-auth-config
          mountPath: "/auth/ironic-inspector"
          readOnly: true
        envFrom:
        - configMapRef:
            name: ironic-htpasswd
        - configMapRef:
            name: ironic-bmo-configmap
      - name: ironic-httpd
        volumeMounts:
        - name: ironic-auth-config
          mountPath: "/auth/ironic"
          readOnly: true
        - name: ironic-inspector-auth-config
          mountPath: "/auth/ironic-inspector"
          readOnly: true
        envFrom:
        - configMapRef:
            name: ironic-htpasswd
        - configMapRef:
            name: ironic-inspector-htpasswd
        - configMapRef:
            name: ironic-bmo-configmap
      - name: ironic-inspector
        volumeMounts:
        - name: ironic-auth-config
          mountPath: "/auth/ironic"
          readOnly: true
        envFrom:
        - configMapRef:
            name: ironic-inspector-htpasswd
        - configMapRef:
            name: ironic-bmo-configmap
      volumes:
      - name: ironic-auth-config
        secret:
          secretName: ironic-auth-config
      - name: ironic-inspector-auth-config
        secret:
          secretName: ironic-inspector-auth-config
---
---
apiVersion: v1
kind: Secret
metadata:
  name: example-baremetalhost-secret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm

---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: example-baremetalhost
spec:
  online: true
  bmc:
    address: ipmi://192.168.122.1:6233
    credentialsName: example-baremetalhost-secret
---
# # Use this file with the -demo flag to the controller to produce 1
# # host in each state.
---
apiVersion: v1
kind: Secret
metadata:
  name: demo-discovered-secret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: demo-discovered

---
apiVersion: machine.openshift.io/v1beta1
kind: Machine
metadata:
  labels:
    sigs.k8s.io/cluster-api-cluster: ostest
    sigs.k8s.io/cluster-api-machine-role: worker
    sigs.k8s.io/cluster-api-machine-type: worker
  name: demo-ostest-worker
  namespace: openshift-machine-api
---
apiVersion: v1
kind: Secret
metadata:
  name: demo-externally-provisioned-secret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: demo-externally-provisioned
spec:
  online: false
  bmc:
    address: ipmi://192.168.122.1:6233
    credentialsName: demo-externally-provisioned-secret
  consumerRef:
    name: demo-ostest-worker
    namespace: openshift-machine-api

---
apiVersion: v1
kind: Secret
metadata:
  name: demo-registration-error-secret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: demo-registration-error
  labels:
    metal3demo: ""
spec:
  online: true
  bmc:
    address: ipmi://192.168.122.1:6233
    credentialsName: demo-registration-error-secret

---
apiVersion: v1
kind: Secret
metadata:
  name: demo-registering-secret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: demo-registering
  labels:
    metal3demo: ""
spec:
  online: true
  bmc:
    address: ipmi://192.168.122.2:6233
    credentialsName: demo-registering-secret

---
apiVersion: v1
kind: Secret
metadata:
  name: demo-available-secret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: demo-available
  labels:
    metal3demo: ""
spec:
  online: true
  bmc:
    address: ipmi://192.168.122.3:6233
    credentialsName: demo-available-secret

---
apiVersion: v1
kind: Secret
metadata:
  name: demo-inspecting-secret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: demo-inspecting
  labels:
    metal3demo: ""
spec:
  online: true
  bmc:
    address: ipmi://192.168.122.4:6233
    credentialsName: demo-inspecting-secret

---
apiVersion: v1
kind: Secret
metadata:
  name: demo-provisioning-secret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: demo-provisioning
  labels:
    metal3demo: ""
spec:
  online: true
  bmc:
    address: ipmi://192.168.122.6:6233
    credentialsName: demo-provisioning-secret
  bootMACAddress: 00:c6:14:04:61:b2
  userData:
    namespace: openshift-machine-api
    name: worker-user-data
  image:
    url: "http://172.22.0.1/images/rhcos-ootpa-latest.qcow2"
    checksum: "http://172.22.0.1/images/rhcos-ootpa-latest.qcow2.md5sum"

---
apiVersion: v1
kind: Secret
metadata:
  name: demo-provisioned-secret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: demo-provisioned
  labels:
    metal3demo: ""
spec:
  online: true
  bmc:
    address: ipmi://192.168.122.8:6233
    credentialsName: demo-provisioned-secret
  bootMACAddress: 00:c6:14:04:61:b2
  userData:
    namespace: openshift-machine-api
    name: worker-user-data
  image:
    url: "http://172.22.0.1/images/rhcos-ootpa-latest.qcow2"
    checksum: "http://172.22.0.1/images/rhcos-ootpa-latest.qcow2.md5sum"

---
apiVersion: v1
kind: Secret
metadata:
  name: demo-validation-error-secret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: demo-validation-error
  labels:
    metal3demo: ""
spec:
  online: true
  bmc:
    address: ipmi://192.168.122.8:6233
    credentialsName: demo-validation-error-secret
  bootMACAddress: 00:c6:14:04:61:b2
  userData:
    namespace: openshift-machine-api
    name: worker-user-data
  image:
    url: "http://172.22.0.1/images/rhcos-ootpa-latest.qcow2"
    checksum: "http://172.22.0.1/images/rhcos-ootpa-latest.qcow2.md5sum"
---
---
apiVersion: v1
kind: Secret
metadata:
  name: worker-0-bmc-secret
type: Opaque
data:
  username: YWRtaW4=
  password: cGFzc3dvcmQ=

---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: worker-0
spec:
  online: true
  bmc:
    address: libvirt://192.168.122.1:6233/
    credentialsName: worker-0-bmc-secret
  bootMACAddress: "00:1a:74:74:e5:cb"
  image:
    url: "http://172.22.0.1/images/rhcos-ootpa-latest.qcow2"
    checksum: "97830b21ed272a3d854615beb54cf004"
  userData:
    name: worker-user-data
    namespace: openshift-machine-api
---
---
apiVersion: v1
kind: Secret
metadata:
  name: example-baremetalhost-secret-no-username
type: Opaque
data:
  username: ""
  password: MWYyZDFlMmU2N2Rm

---
apiVersion: v1
kind: Secret
metadata:
  name: example-baremetalhost-secret-no-password
type: Opaque
data:
  username: YWRtaW4=
  password: ""

---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: example-baremetalhost
spec:
  online: true
  bmc:
    address: ipmi://192.168.122.1:6233
    credentialsName: example-baremetalhost-secret-no-password
---
# permissions to do leader election.
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: leader-election-role
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - ""
  resources:
  - configmaps/status
  verbs:
  - get
  - update
  - patch
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
- apiGroups:
  - coordination.k8s.io
  resources:
  - leases
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: proxy-rolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: proxy-role
subjects:
- kind: ServiceAccount
  name: controller-manager
  namespace: system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: controller-manager
  namespace: system
---
# permissions for end users to edit firmwareschemas.
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: firmwareschema-editor-role
rules:
- apiGroups:
  - metal3.io
  resources:
  - firmwareschemas
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - metal3.io
  resources:
  - firmwareschemas/status
  verbs:
  - get
---
# permissions for end users to view baremetalhosts.
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: baremetalhost-viewer-role
rules:
- apiGroups:
  - metal3.io
  resources:
  - baremetalhosts
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - metal3.io
  resources:
  - baremetalhosts/status
  verbs:
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: manager-rolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: manager-role
subjects:
- kind: ServiceAccount
  name: controller-manager
  namespace: system
---
# permissions for end users to edit baremetalhosts.
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: baremetalhost-editor-role
rules:
- apiGroups:
  - metal3.io
  resources:
  - baremetalhosts
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - metal3.io
  resources:
  - baremetalhosts/status
  verbs:
  - get
---
# permissions for end users to edit bmceventsubscriptions.
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: bmceventsubscription-editor-role
rules:
- apiGroups:
  - metal3.io
  resources:
  - bmceventsubscriptions
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - metal3.io
  resources:
  - bmceventsubscriptions/status
  verbs:
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: metrics-reader
rules:
- nonResourceURLs:
  - "/metrics"
  verbs:
  - get
---
# permissions for end users to view preprovisioningimages.
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: preprovisioningimage-viewer-role
rules:
- apiGroups:
  - metal3.io
  resources:
  - preprovisioningimages
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - metal3.io
  resources:
  - preprovisioningimages/status
  verbs:
  - get
---
apiVersion: v1
kind: Service
metadata:
  labels:
    control-plane: controller-manager
  name: controller-manager-metrics-service
  namespace: system
spec:
  ports:
  - name: https
    port: 8443
    targetPort: https
  selector:
    control-plane: controller-manager
---
# permissions for end users to view firmwareschemas.
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: firmwareschema-viewer-role
rules:
- apiGroups:
  - metal3.io
  resources:
  - firmwareschemas
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - metal3.io
  resources:
  - firmwareschemas/status
  verbs:
  - get
---

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  creationTimestamp: null
  name: manager-role
rules:
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - get
  - list
  - update
  - watch
- apiGroups:
  - metal3.io
  resources:
  - baremetalhosts
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - metal3.io
  resources:
  - baremetalhosts/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - metal3.io
  resources:
  - bmceventsubscriptions
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - metal3.io
  resources:
  - bmceventsubscriptions/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - metal3.io
  resources:
  - firmwareschemas
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - metal3.io
  resources:
  - firmwareschemas/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - metal3.io
  resources:
  - hostfirmwaresettings
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - metal3.io
  resources:
  - hostfirmwaresettings/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - metal3.io
  resources:
  - preprovisioningimages
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - metal3.io
  resources:
  - preprovisioningimages/status
  verbs:
  - get
  - patch
  - update
---
# permissions for end users to edit preprovisioningimages.
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: preprovisioningimage-editor-role
rules:
- apiGroups:
  - metal3.io
  resources:
  - preprovisioningimages
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - metal3.io
  resources:
  - preprovisioningimages/status
  verbs:
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: proxy-role
rules:
- apiGroups:
  - authentication.k8s.io
  resources:
  - tokenreviews
  verbs:
  - create
- apiGroups:
  - authorization.k8s.io
  resources:
  - subjectaccessreviews
  verbs:
  - create
---
# permissions for end users to view bmceventsubscriptions.
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: bmceventsubscription-viewer-role
rules:
- apiGroups:
  - metal3.io
  resources:
  - bmceventsubscriptions
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - metal3.io
  resources:
  - bmceventsubscriptions/status
  verbs:
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: leader-election-rolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: leader-election-role
subjects:
- kind: ServiceAccount
  name: controller-manager
  namespace: system
---
resources:
# All RBAC will be applied under this service account in
# the deployment namespace. You may comment out this resource
# if your manager will use a service account that exists at
# runtime. Be sure to update RoleBinding and ClusterRoleBinding
# subjects if changing service account names.
- service_account.yaml
- role.yaml
- role_binding.yaml
- leader_election_role.yaml
- leader_election_role_binding.yaml
# Comment the following 4 lines if you want to disable
# the auth proxy (https://github.com/brancz/kube-rbac-proxy)
# which protects your /metrics endpoint.
- auth_proxy_service.yaml
- auth_proxy_role.yaml
- auth_proxy_role_binding.yaml
- auth_proxy_client_clusterrole.yaml
---
# permissions for end users to edit hostfirmwaresettings.
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: hostfirmwaresettings-editor-role
rules:
- apiGroups:
  - metal3.io
  resources:
  - hostfirmwaresettings
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - metal3.io
  resources:
  - hostfirmwaresettings/status
  verbs:
  - get
---
# permissions for end users to view hostfirmwaresettings.
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: hostfirmwaresettings-viewer-role
rules:
- apiGroups:
  - metal3.io
  resources:
  - hostfirmwaresettings
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - metal3.io
  resources:
  - hostfirmwaresettings/status
  verbs:
  - get
---
# The following manifests contain a self-signed issuer CR and a certificate CR.
# More document can be found at https://docs.cert-manager.io
# WARNING: Targets CertManager 0.11 check https://docs.cert-manager.io/en/latest/tasks/upgrading/index.html for 
# breaking changes
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  name: selfsigned-issuer
  namespace: system
spec:
  selfSigned: {}
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: serving-cert  # this name should match the one appeared in kustomizeconfig.yaml
  namespace: system
spec:
  # $(SERVICE_NAME) and $(SERVICE_NAMESPACE) will be substituted by kustomize
  dnsNames:
  - $(SERVICE_NAME).$(SERVICE_NAMESPACE).svc
  - $(SERVICE_NAME).$(SERVICE_NAMESPACE).svc.cluster.local
  issuerRef:
    kind: Issuer
    name: selfsigned-issuer
  secretName: bmo-webhook-server-cert # this secret will not be prefixed, since it's not managed by kustomize
---
resources:
- certificate.yaml

configurations:
- kustomizeconfig.yaml
---
# This configuration is for teaching kustomize how to update name ref and var substitution 
nameReference:
- kind: Issuer
  group: cert-manager.io
  fieldSpecs:
  - kind: Certificate
    group: cert-manager.io
    path: spec/issuerRef/name

varReference:
- kind: Certificate
  group: cert-manager.io
  path: spec/commonName
- kind: Certificate
  group: cert-manager.io
  path: spec/dnsNames
---

# Prometheus Monitor Service (Metrics)
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  labels:
    control-plane: controller-manager
  name: controller-manager-metrics-monitor
  namespace: system
spec:
  endpoints:
    - path: /metrics
      port: https
      scheme: https
      bearerTokenFile: /var/run/secrets/kubernetes.io/serviceaccount/token
      tlsConfig:
        insecureSkipVerify: true
  selector:
    matchLabels:
      control-plane: controller-manager
---
resources:
- monitor.yaml
---

apiVersion: v1
kind: Service
metadata:
  name: webhook-service
  namespace: system
spec:
  ports:
    - port: 443
      targetPort: 9443
  selector:
    control-plane: controller-manager
    webhook: metal3-io-v1alpha1-baremetalhost---

---
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  creationTimestamp: null
  name: validating-webhook-configuration
webhooks:
- admissionReviewVersions:
  - v1
  - v1beta
  clientConfig:
    service:
      name: webhook-service
      namespace: system
      path: /validate-metal3-io-v1alpha1-baremetalhost
  failurePolicy: Fail
  name: baremetalhost.metal3.io
  rules:
  - apiGroups:
    - metal3.io
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - baremetalhosts
  sideEffects: None
- admissionReviewVersions:
  - v1
  - v1beta
  clientConfig:
    service:
      name: webhook-service
      namespace: system
      path: /validate-metal3-io-v1alpha1-bmceventsubscription
  failurePolicy: Fail
  name: bmceventsubscription.metal3.io
  rules:
  - apiGroups:
    - metal3.io
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - bmceventsubscriptions
  sideEffects: None
---
resources:
- manifests.yaml
- service_patch.yaml

configurations:
- kustomizeconfig.yaml---
# the following config is for teaching kustomize where to look at when substituting vars.
# It requires kustomize v2.1.0 or newer to work properly.
nameReference:
- kind: Service
  version: v1
  fieldSpecs:
#  - kind: MutatingWebhookConfiguration
#    group: admissionregistration.k8s.io
#    path: webhooks/clientConfig/service/name
  - kind: ValidatingWebhookConfiguration
    group: admissionregistration.k8s.io
    path: webhooks/clientConfig/service/name

namespace:
#- kind: MutatingWebhookConfiguration
#  group: admissionregistration.k8s.io
#  path: webhooks/clientConfig/service/namespace
#  create: true
- kind: ValidatingWebhookConfiguration
  group: admissionregistration.k8s.io
  path: webhooks/clientConfig/service/namespace
  create: true

varReference:
- path: metadata/annotations
---
apiVersion: metal3.io/v1alpha1
kind: HostFirmwareSettings
metadata:
  name: hostfirmwaresettings-sample
spec:
  settings:
    - "ProcVirtualization": "Enabled"
    - "SRIOV": "Enabled"
    - "NetworkBootRetryCount": "20"
status:
  settings:
    - "ProcVirtualization": "Enabled"
    - "ProcCPUCores": "100"
    - "SRIOV": "Enabled"
    - "SystemModelName":  "QYZ12345"
    - "SerialNumber": "22654891"
    - "NetworkBootRetryCount": "10"
---
apiVersion: metal3.io/v1alpha1
kind: PreprovisioningImage
metadata:
  name: preprovisioningimage-sample
spec:
  # Add fields here
  foo: bar
---
apiVersion: metal3.io/v1alpha1
kind: FirmwareSchema
metadata:
  name: firmwareschema-sample
spec:
status:
  referenceCount: 2
  hardwareVendor: "VendorA"
  hardwareModel: "ModelT"
  schema:
    - "ProcVirtualization":
         attribute_type: "Enumeration"
         allowable_values:
           - "Enabled"
           - "Disabled"
         read_only: false
    - "ProcCPUCores":
         attribute_type: "Integer"
         lower_bound: 1
         read_only: true
         upper_bound: 100
    - "SRIOV":
         allowable_values:
           - "Enabled"
           - "Disabled"
    - "SystemModelName":
         attribute_type: "String"
         max_length: 40
         min_length: 0
         read_only: true
    - "SerialNumber":
         attribute_type: "String"
         max_length: 16
         min_length: 0
---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: baremetalhost-sample
spec:
  # Add fields here
  foo: bar
---
# This patch add annotation to admission webhook config and
# the variables $(CERTIFICATE_NAMESPACE) and $(CERTIFICATE_NAME) will be substituted by kustomize.
#apiVersion: admissionregistration.k8s.io/v1
#kind: MutatingWebhookConfiguration
#metadata:
#  name: mutating-webhook-configuration
#  annotations:
#    cert-manager.io/inject-ca-from: $(CERTIFICATE_NAMESPACE)/$(CERTIFICATE_NAME)
#---
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  name: validating-webhook-configuration
  annotations:
    cert-manager.io/inject-ca-from: $(CERTIFICATE_NAMESPACE)/$(CERTIFICATE_NAME)
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: controller-manager
  namespace: system
spec:
  template:
    spec:
      containers:
      - name: manager
        ports:
        - containerPort: 9443
          name: webhook-server
          protocol: TCP
        volumeMounts:
        - mountPath: /tmp/k8s-webhook-server/serving-certs
          name: cert
          readOnly: true
      volumes:
      - name: cert
        secret:
          defaultMode: 420
          secretName: bmo-webhook-server-cert
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: controller-manager
  namespace: system
spec:
  template:
    spec:
      containers:
      - name: manager
        args:
        - "--config=controller_manager_config.yaml"
        volumeMounts:
        - name: manager-config
          mountPath: /controller_manager_config.yaml
          subPath: controller_manager_config.yaml
      volumes:
      - name: manager-config
        configMap:
          name: manager-config
---
# This patch inject a sidecar container which is a HTTP proxy for the
# controller manager, it performs RBAC authorization against the Kubernetes API using SubjectAccessReviews.
apiVersion: apps/v1
kind: Deployment
metadata:
  name: controller-manager
  namespace: system
spec:
  template:
    spec:
      containers:
      - name: kube-rbac-proxy
        image: gcr.io/kubebuilder/kube-rbac-proxy:v0.8.0
        args:
        - "--secure-listen-address=0.0.0.0:8443"
        - "--upstream=http://127.0.0.1:8085/"
        - "--logtostderr=true"
        - "--v=10"
        ports:
        - containerPort: 8443
          name: https
      - name: manager
        args:
        - "--metrics-addr=127.0.0.1:8085"
        - "--enable-leader-election"
---
# Adds namespace to all resources.
namespace: baremetal-operator-system

# Value of this field is prepended to the
# names of all resources, e.g. a deployment named
# "wordpress" becomes "alices-wordpress".
# Note that it should also match with the prefix (text before '-') of the namespace
# field above.
namePrefix: baremetal-operator-

# Labels to add to all resources and selectors.
#commonLabels:
#  someName: someValue

bases:
- ../crd
- ../rbac
- ../manager
# [WEBHOOK] To enable webhook, uncomment all the sections with [WEBHOOK] prefix including the one in
# crd/kustomization.yaml
- ../webhook
# [CERTMANAGER] To enable cert-manager, uncomment all sections with 'CERTMANAGER'. 'WEBHOOK' components are required.
- ../certmanager
# [PROMETHEUS] To enable prometheus monitor, uncomment all sections with 'PROMETHEUS'.
#- ../prometheus

patchesStrategicMerge:
# Protect the /metrics endpoint by putting it behind auth.
# If you want your controller-manager to expose the /metrics
# endpoint w/o any authn/z, please comment the following line.
- manager_auth_proxy_patch.yaml

# Mount the controller config file for loading manager configurations
# through a ComponentConfig type
#- manager_config_patch.yaml

# [WEBHOOK] To enable webhook, uncomment all the sections with [WEBHOOK] prefix including the one in
# crd/kustomization.yaml
- manager_webhook_patch.yaml

# [CERTMANAGER] To enable cert-manager, uncomment all sections with 'CERTMANAGER'.
# Uncomment 'CERTMANAGER' sections in crd/kustomization.yaml to enable the CA injection in the admission webhooks.
# 'CERTMANAGER' needs to be enabled to use ca injection
- webhookcainjection_patch.yaml

# the following config is for teaching kustomize how to do var substitution
vars:
# [CERTMANAGER] To enable cert-manager, uncomment all sections with 'CERTMANAGER' prefix.
- name: CERTIFICATE_NAMESPACE # namespace of the certificate CR
  objref:
    kind: Certificate
    group: cert-manager.io
    version: v1
    name: serving-cert # this name should match the one in certificate.yaml
  fieldref:
    fieldpath: metadata.namespace
- name: CERTIFICATE_NAME
  objref:
    kind: Certificate
    group: cert-manager.io
    version: v1
    name: serving-cert # this name should match the one in certificate.yaml
- name: SERVICE_NAMESPACE # namespace of the service
  objref:
    kind: Service
    version: v1
    name: webhook-service
  fieldref:
    fieldpath: metadata.namespace
- name: SERVICE_NAME
  objref:
    kind: Service
    version: v1
    name: webhook-service

# Add ironic configmap-generator 
generatorOptions:
 disableNameSuffixHash: true
 
configMapGenerator:
- behavior: create
  envs:
  - ironic.env
  name: ironic
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    cert-manager.io/inject-ca-from: baremetal-operator-system/baremetal-operator-serving-cert
    controller-gen.kubebuilder.io/version: v0.6.2
  name: baremetalhosts.metal3.io
spec:
  group: metal3.io
  names:
    kind: BareMetalHost
    listKind: BareMetalHostList
    plural: baremetalhosts
    shortNames:
    - bmh
    - bmhost
    singular: baremetalhost
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Operational status
      jsonPath: .status.operationalStatus
      name: Status
      priority: 1
      type: string
    - description: Provisioning status
      jsonPath: .status.provisioning.state
      name: State
      type: string
    - description: Consumer using this host
      jsonPath: .spec.consumerRef.name
      name: Consumer
      type: string
    - description: Address of management controller
      jsonPath: .spec.bmc.address
      name: BMC
      priority: 1
      type: string
    - description: The type of hardware detected
      jsonPath: .status.hardwareProfile
      name: Hardware_Profile
      priority: 1
      type: string
    - description: Whether the host is online or not
      jsonPath: .spec.online
      name: Online
      type: string
    - description: Type of the most recent error
      jsonPath: .status.errorType
      name: Error
      type: string
    - description: Time duration since creation of BaremetalHost
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: BareMetalHost is the Schema for the baremetalhosts API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: BareMetalHostSpec defines the desired state of BareMetalHost
            properties:
              automatedCleaningMode:
                default: metadata
                description: When set to disabled, automated cleaning will be avoided
                  during provisioning and deprovisioning.
                enum:
                - metadata
                - disabled
                type: string
              bmc:
                description: How do we connect to the BMC?
                properties:
                  address:
                    description: Address holds the URL for accessing the controller
                      on the network.
                    type: string
                  credentialsName:
                    description: The name of the secret containing the BMC credentials
                      (requires keys "username" and "password").
                    type: string
                  disableCertificateVerification:
                    description: DisableCertificateVerification disables verification
                      of server certificates when using HTTPS to connect to the BMC.
                      This is required when the server certificate is self-signed,
                      but is insecure because it allows a man-in-the-middle to intercept
                      the connection.
                    type: boolean
                required:
                - address
                - credentialsName
                type: object
              bootMACAddress:
                description: Which MAC address will PXE boot? This is optional for
                  some types, but required for libvirt VMs driven by vbmc.
                pattern: '[0-9a-fA-F]{2}(:[0-9a-fA-F]{2}){5}'
                type: string
              bootMode:
                description: Select the method of initializing the hardware during
                  boot. Defaults to UEFI.
                enum:
                - UEFI
                - UEFISecureBoot
                - legacy
                type: string
              consumerRef:
                description: ConsumerRef can be used to store information about something
                  that is using a host. When it is not empty, the host is considered
                  "in use".
                properties:
                  apiVersion:
                    description: API version of the referent.
                    type: string
                  fieldPath:
                    description: 'If referring to a piece of an object instead of
                      an entire object, this string should contain a valid JSON/Go
                      field access statement, such as desiredState.manifest.containers[2].
                      For example, if the object reference is to a container within
                      a pod, this would take on a value like: "spec.containers{name}"
                      (where "name" refers to the name of the container that triggered
                      the event) or if no container name is specified "spec.containers[2]"
                      (container with index 2 in this pod). This syntax is chosen
                      only to have some well-defined way of referencing a part of
                      an object. TODO: this design is not final and this field is
                      subject to change in the future.'
                    type: string
                  kind:
                    description: 'Kind of the referent. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
                    type: string
                  name:
                    description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names'
                    type: string
                  namespace:
                    description: 'Namespace of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/'
                    type: string
                  resourceVersion:
                    description: 'Specific resourceVersion to which this reference
                      is made, if any. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency'
                    type: string
                  uid:
                    description: 'UID of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids'
                    type: string
                type: object
              customDeploy:
                description: A custom deploy procedure.
                properties:
                  method:
                    description: Custom deploy method name. This name is specific
                      to the deploy ramdisk used. If you don't have a custom deploy
                      ramdisk, you shouldn't use CustomDeploy.
                    type: string
                required:
                - method
                type: object
              description:
                description: Description is a human-entered text used to help identify
                  the host
                type: string
              externallyProvisioned:
                description: ExternallyProvisioned means something else is managing
                  the image running on the host and the operator should only manage
                  the power status and hardware inventory inspection. If the Image
                  field is filled in, this field is ignored.
                type: boolean
              firmware:
                description: BIOS configuration for bare metal server
                properties:
                  simultaneousMultithreadingEnabled:
                    description: 'Allows a single physical processor core to appear
                      as several logical processors. This supports following options:
                      true, false.'
                    enum:
                    - true
                    - false
                    type: boolean
                  sriovEnabled:
                    description: 'SR-IOV support enables a hypervisor to create virtual
                      instances of a PCI-express device, potentially increasing performance.
                      This supports following options: true, false.'
                    enum:
                    - true
                    - false
                    type: boolean
                  virtualizationEnabled:
                    description: 'Supports the virtualization of platform hardware.
                      This supports following options: true, false.'
                    enum:
                    - true
                    - false
                    type: boolean
                type: object
              hardwareProfile:
                description: What is the name of the hardware profile for this host?
                  It should only be necessary to set this when inspection cannot automatically
                  determine the profile.
                type: string
              image:
                description: Image holds the details of the image to be provisioned.
                properties:
                  checksum:
                    description: Checksum is the checksum for the image.
                    type: string
                  checksumType:
                    description: ChecksumType is the checksum algorithm for the image.
                      e.g md5, sha256, sha512
                    enum:
                    - md5
                    - sha256
                    - sha512
                    type: string
                  format:
                    description: DiskFormat contains the format of the image (raw,
                      qcow2, ...). Needs to be set to raw for raw images streaming.
                      Note live-iso means an iso referenced by the url will be live-booted
                      and not deployed to disk, and in this case the checksum options
                      are not required and if specified will be ignored.
                    enum:
                    - raw
                    - qcow2
                    - vdi
                    - vmdk
                    - live-iso
                    type: string
                  url:
                    description: URL is a location of an image to deploy.
                    type: string
                required:
                - url
                type: object
              metaData:
                description: MetaData holds the reference to the Secret containing
                  host metadata (e.g. meta_data.json) which is passed to the Config
                  Drive.
                properties:
                  name:
                    description: Name is unique within a namespace to reference a
                      secret resource.
                    type: string
                  namespace:
                    description: Namespace defines the space within which the secret
                      name must be unique.
                    type: string
                type: object
              networkData:
                description: NetworkData holds the reference to the Secret containing
                  network configuration (e.g content of network_data.json) which is
                  passed to the Config Drive.
                properties:
                  name:
                    description: Name is unique within a namespace to reference a
                      secret resource.
                    type: string
                  namespace:
                    description: Namespace defines the space within which the secret
                      name must be unique.
                    type: string
                type: object
              online:
                description: Should the server be online?
                type: boolean
              preprovisioningNetworkDataName:
                description: PreprovisioningNetworkDataName is the name of the Secret
                  in the local namespace containing network configuration (e.g content
                  of network_data.json) which is passed to the preprovisioning image,
                  and to the Config Drive if not overridden by specifying NetworkData.
                type: string
              raid:
                description: RAID configuration for bare metal server
                properties:
                  hardwareRAIDVolumes:
                    description: The list of logical disks for hardware RAID, if rootDeviceHints
                      isn't used, first volume is root volume. You can set the value
                      of this field to `[]` to clear all the hardware RAID configurations.
                    items:
                      description: HardwareRAIDVolume defines the desired configuration
                        of volume in hardware RAID
                      properties:
                        controller:
                          description: The name of the RAID controller to use
                          type: string
                        level:
                          description: 'RAID level for the logical disk. The following
                            levels are supported: 0;1;2;5;6;1+0;5+0;6+0.'
                          enum:
                          - "0"
                          - "1"
                          - "2"
                          - "5"
                          - "6"
                          - 1+0
                          - 5+0
                          - 6+0
                          type: string
                        name:
                          description: Name of the volume. Should be unique within
                            the Node. If not specified, volume name will be auto-generated.
                          maxLength: 64
                          type: string
                        numberOfPhysicalDisks:
                          description: Integer, number of physical disks to use for
                            the logical disk. Defaults to minimum number of disks
                            required for the particular RAID level.
                          minimum: 1
                          type: integer
                        physicalDisks:
                          description: Optional list of physical disk names to be
                            used for the Hardware RAID volumes. The disk names are
                            interpreted by the Hardware RAID controller, and the format
                            is hardware specific.
                          items:
                            type: string
                          type: array
                        rotational:
                          description: Select disks with only rotational or solid-state
                            storage
                          type: boolean
                        sizeGibibytes:
                          description: Size (Integer) of the logical disk to be created
                            in GiB. If unspecified or set be 0, the maximum capacity
                            of disk will be used for logical disk.
                          minimum: 0
                          type: integer
                      required:
                      - level
                      type: object
                    nullable: true
                    type: array
                  softwareRAIDVolumes:
                    description: The list of logical disks for software RAID, if rootDeviceHints
                      isn't used, first volume is root volume. If HardwareRAIDVolumes
                      is set this item will be invalid. The number of created Software
                      RAID devices must be 1 or 2. If there is only one Software RAID
                      device, it has to be a RAID-1. If there are two, the first one
                      has to be a RAID-1, while the RAID level for the second one
                      can be 0, 1, or 1+0. As the first RAID device will be the deployment
                      device, enforcing a RAID-1 reduces the risk of ending up with
                      a non-booting node in case of a disk failure. Software RAID
                      will always be deleted.
                    items:
                      description: SoftwareRAIDVolume defines the desired configuration
                        of volume in software RAID
                      properties:
                        level:
                          description: 'RAID level for the logical disk. The following
                            levels are supported: 0;1;1+0.'
                          enum:
                          - "0"
                          - "1"
                          - 1+0
                          type: string
                        physicalDisks:
                          description: A list of device hints, the number of items
                            should be greater than or equal to 2.
                          items:
                            description: RootDeviceHints holds the hints for specifying
                              the storage location for the root filesystem for the
                              image.
                            properties:
                              deviceName:
                                description: A Linux device name like "/dev/vda".
                                  The hint must match the actual value exactly.
                                type: string
                              hctl:
                                description: A SCSI bus address like 0:0:0:0. The
                                  hint must match the actual value exactly.
                                type: string
                              minSizeGigabytes:
                                description: The minimum size of the device in Gigabytes.
                                minimum: 0
                                type: integer
                              model:
                                description: A vendor-specific device identifier.
                                  The hint can be a substring of the actual value.
                                type: string
                              rotational:
                                description: True if the device should use spinning
                                  media, false otherwise.
                                type: boolean
                              serialNumber:
                                description: Device serial number. The hint must match
                                  the actual value exactly.
                                type: string
                              vendor:
                                description: The name of the vendor or manufacturer
                                  of the device. The hint can be a substring of the
                                  actual value.
                                type: string
                              wwn:
                                description: Unique storage identifier. The hint must
                                  match the actual value exactly.
                                type: string
                              wwnVendorExtension:
                                description: Unique vendor storage identifier. The
                                  hint must match the actual value exactly.
                                type: string
                              wwnWithExtension:
                                description: Unique storage identifier with the vendor
                                  extension appended. The hint must match the actual
                                  value exactly.
                                type: string
                            type: object
                          minItems: 2
                          type: array
                        sizeGibibytes:
                          description: Size (Integer) of the logical disk to be created
                            in GiB. If unspecified or set be 0, the maximum capacity
                            of disk will be used for logical disk.
                          minimum: 0
                          type: integer
                      required:
                      - level
                      type: object
                    maxItems: 2
                    nullable: true
                    type: array
                type: object
              rootDeviceHints:
                description: Provide guidance about how to choose the device for the
                  image being provisioned.
                properties:
                  deviceName:
                    description: A Linux device name like "/dev/vda". The hint must
                      match the actual value exactly.
                    type: string
                  hctl:
                    description: A SCSI bus address like 0:0:0:0. The hint must match
                      the actual value exactly.
                    type: string
                  minSizeGigabytes:
                    description: The minimum size of the device in Gigabytes.
                    minimum: 0
                    type: integer
                  model:
                    description: A vendor-specific device identifier. The hint can
                      be a substring of the actual value.
                    type: string
                  rotational:
                    description: True if the device should use spinning media, false
                      otherwise.
                    type: boolean
                  serialNumber:
                    description: Device serial number. The hint must match the actual
                      value exactly.
                    type: string
                  vendor:
                    description: The name of the vendor or manufacturer of the device.
                      The hint can be a substring of the actual value.
                    type: string
                  wwn:
                    description: Unique storage identifier. The hint must match the
                      actual value exactly.
                    type: string
                  wwnVendorExtension:
                    description: Unique vendor storage identifier. The hint must match
                      the actual value exactly.
                    type: string
                  wwnWithExtension:
                    description: Unique storage identifier with the vendor extension
                      appended. The hint must match the actual value exactly.
                    type: string
                type: object
              taints:
                description: Taints is the full, authoritative list of taints to apply
                  to the corresponding Machine. This list will overwrite any modifications
                  made to the Machine on an ongoing basis.
                items:
                  description: The node this Taint is attached to has the "effect"
                    on any pod that does not tolerate the Taint.
                  properties:
                    effect:
                      description: Required. The effect of the taint on pods that
                        do not tolerate the taint. Valid effects are NoSchedule, PreferNoSchedule
                        and NoExecute.
                      type: string
                    key:
                      description: Required. The taint key to be applied to a node.
                      type: string
                    timeAdded:
                      description: TimeAdded represents the time at which the taint
                        was added. It is only written for NoExecute taints.
                      format: date-time
                      type: string
                    value:
                      description: The taint value corresponding to the taint key.
                      type: string
                  required:
                  - effect
                  - key
                  type: object
                type: array
              userData:
                description: UserData holds the reference to the Secret containing
                  the user data to be passed to the host before it boots.
                properties:
                  name:
                    description: Name is unique within a namespace to reference a
                      secret resource.
                    type: string
                  namespace:
                    description: Namespace defines the space within which the secret
                      name must be unique.
                    type: string
                type: object
            required:
            - online
            type: object
          status:
            description: BareMetalHostStatus defines the observed state of BareMetalHost
            properties:
              errorCount:
                default: 0
                description: ErrorCount records how many times the host has encoutered
                  an error since the last successful operation
                type: integer
              errorMessage:
                description: the last error message reported by the provisioning subsystem
                type: string
              errorType:
                description: ErrorType indicates the type of failure encountered when
                  the OperationalStatus is OperationalStatusError
                enum:
                - provisioned registration error
                - registration error
                - inspection error
                - preparation error
                - provisioning error
                - power management error
                type: string
              goodCredentials:
                description: the last credentials we were able to validate as working
                properties:
                  credentials:
                    description: SecretReference represents a Secret Reference. It
                      has enough information to retrieve secret in any namespace
                    properties:
                      name:
                        description: Name is unique within a namespace to reference
                          a secret resource.
                        type: string
                      namespace:
                        description: Namespace defines the space within which the
                          secret name must be unique.
                        type: string
                    type: object
                  credentialsVersion:
                    type: string
                type: object
              hardware:
                description: The hardware discovered to exist on the host.
                properties:
                  cpu:
                    description: CPU describes one processor on the host.
                    properties:
                      arch:
                        type: string
                      clockMegahertz:
                        description: ClockSpeed is a clock speed in MHz
                        format: double
                        type: number
                      count:
                        type: integer
                      flags:
                        items:
                          type: string
                        type: array
                      model:
                        type: string
                    type: object
                  firmware:
                    description: Firmware describes the firmware on the host.
                    properties:
                      bios:
                        description: The BIOS for this firmware
                        properties:
                          date:
                            description: The release/build date for this BIOS
                            type: string
                          vendor:
                            description: The vendor name for this BIOS
                            type: string
                          version:
                            description: The version of the BIOS
                            type: string
                        type: object
                    type: object
                  hostname:
                    type: string
                  nics:
                    items:
                      description: NIC describes one network interface on the host.
                      properties:
                        ip:
                          description: The IP address of the interface. This will
                            be an IPv4 or IPv6 address if one is present.  If both
                            IPv4 and IPv6 addresses are present in a dual-stack environment,
                            two nics will be output, one with each IP.
                          type: string
                        mac:
                          description: The device MAC address
                          pattern: '[0-9a-fA-F]{2}(:[0-9a-fA-F]{2}){5}'
                          type: string
                        model:
                          description: The vendor and product IDs of the NIC, e.g.
                            "0x8086 0x1572"
                          type: string
                        name:
                          description: The name of the network interface, e.g. "en0"
                          type: string
                        pxe:
                          description: Whether the NIC is PXE Bootable
                          type: boolean
                        speedGbps:
                          description: The speed of the device in Gigabits per second
                          type: integer
                        vlanId:
                          description: The untagged VLAN ID
                          format: int32
                          maximum: 4094
                          minimum: 0
                          type: integer
                        vlans:
                          description: The VLANs available
                          items:
                            description: VLAN represents the name and ID of a VLAN
                            properties:
                              id:
                                description: VLANID is a 12-bit 802.1Q VLAN identifier
                                format: int32
                                maximum: 4094
                                minimum: 0
                                type: integer
                              name:
                                type: string
                            type: object
                          type: array
                      type: object
                    type: array
                  ramMebibytes:
                    type: integer
                  storage:
                    items:
                      description: Storage describes one storage device (disk, SSD,
                        etc.) on the host.
                      properties:
                        hctl:
                          description: The SCSI location of the device
                          type: string
                        model:
                          description: Hardware model
                          type: string
                        name:
                          description: The Linux device name of the disk, e.g. "/dev/sda".
                            Note that this may not be stable across reboots.
                          type: string
                        rotational:
                          description: Whether this disk represents rotational storage.
                            This field is not recommended for usage, please prefer
                            using 'Type' field instead, this field will be deprecated
                            eventually.
                          type: boolean
                        serialNumber:
                          description: The serial number of the device
                          type: string
                        sizeBytes:
                          description: The size of the disk in Bytes
                          format: int64
                          type: integer
                        type:
                          description: 'Device type, one of: HDD, SSD, NVME.'
                          enum:
                          - HDD
                          - SSD
                          - NVME
                          type: string
                        vendor:
                          description: The name of the vendor of the device
                          type: string
                        wwn:
                          description: The WWN of the device
                          type: string
                        wwnVendorExtension:
                          description: The WWN Vendor extension of the device
                          type: string
                        wwnWithExtension:
                          description: The WWN with the extension
                          type: string
                      type: object
                    type: array
                  systemVendor:
                    description: HardwareSystemVendor stores details about the whole
                      hardware system.
                    properties:
                      manufacturer:
                        type: string
                      productName:
                        type: string
                      serialNumber:
                        type: string
                    type: object
                type: object
              hardwareProfile:
                description: The name of the profile matching the hardware details.
                type: string
              lastUpdated:
                description: LastUpdated identifies when this status was last observed.
                format: date-time
                type: string
              operationHistory:
                description: OperationHistory holds information about operations performed
                  on this host.
                properties:
                  deprovision:
                    description: OperationMetric contains metadata about an operation
                      (inspection, provisioning, etc.) used for tracking metrics.
                    properties:
                      end:
                        format: date-time
                        nullable: true
                        type: string
                      start:
                        format: date-time
                        nullable: true
                        type: string
                    type: object
                  inspect:
                    description: OperationMetric contains metadata about an operation
                      (inspection, provisioning, etc.) used for tracking metrics.
                    properties:
                      end:
                        format: date-time
                        nullable: true
                        type: string
                      start:
                        format: date-time
                        nullable: true
                        type: string
                    type: object
                  provision:
                    description: OperationMetric contains metadata about an operation
                      (inspection, provisioning, etc.) used for tracking metrics.
                    properties:
                      end:
                        format: date-time
                        nullable: true
                        type: string
                      start:
                        format: date-time
                        nullable: true
                        type: string
                    type: object
                  register:
                    description: OperationMetric contains metadata about an operation
                      (inspection, provisioning, etc.) used for tracking metrics.
                    properties:
                      end:
                        format: date-time
                        nullable: true
                        type: string
                      start:
                        format: date-time
                        nullable: true
                        type: string
                    type: object
                type: object
              operationalStatus:
                description: OperationalStatus holds the status of the host
                enum:
                - ""
                - OK
                - discovered
                - error
                - delayed
                - detached
                type: string
              poweredOn:
                description: indicator for whether or not the host is powered on
                type: boolean
              provisioning:
                description: Information tracked by the provisioner.
                properties:
                  ID:
                    description: The machine's UUID from the underlying provisioning
                      tool
                    type: string
                  bootMode:
                    description: BootMode indicates the boot mode used to provision
                      the node
                    enum:
                    - UEFI
                    - UEFISecureBoot
                    - legacy
                    type: string
                  customDeploy:
                    description: Custom deploy procedure applied to the host.
                    properties:
                      method:
                        description: Custom deploy method name. This name is specific
                          to the deploy ramdisk used. If you don't have a custom deploy
                          ramdisk, you shouldn't use CustomDeploy.
                        type: string
                    required:
                    - method
                    type: object
                  firmware:
                    description: The Bios set by the user
                    properties:
                      simultaneousMultithreadingEnabled:
                        description: 'Allows a single physical processor core to appear
                          as several logical processors. This supports following options:
                          true, false.'
                        enum:
                        - true
                        - false
                        type: boolean
                      sriovEnabled:
                        description: 'SR-IOV support enables a hypervisor to create
                          virtual instances of a PCI-express device, potentially increasing
                          performance. This supports following options: true, false.'
                        enum:
                        - true
                        - false
                        type: boolean
                      virtualizationEnabled:
                        description: 'Supports the virtualization of platform hardware.
                          This supports following options: true, false.'
                        enum:
                        - true
                        - false
                        type: boolean
                    type: object
                  image:
                    description: Image holds the details of the last image successfully
                      provisioned to the host.
                    properties:
                      checksum:
                        description: Checksum is the checksum for the image.
                        type: string
                      checksumType:
                        description: ChecksumType is the checksum algorithm for the
                          image. e.g md5, sha256, sha512
                        enum:
                        - md5
                        - sha256
                        - sha512
                        type: string
                      format:
                        description: DiskFormat contains the format of the image (raw,
                          qcow2, ...). Needs to be set to raw for raw images streaming.
                          Note live-iso means an iso referenced by the url will be
                          live-booted and not deployed to disk, and in this case the
                          checksum options are not required and if specified will
                          be ignored.
                        enum:
                        - raw
                        - qcow2
                        - vdi
                        - vmdk
                        - live-iso
                        type: string
                      url:
                        description: URL is a location of an image to deploy.
                        type: string
                    required:
                    - url
                    type: object
                  raid:
                    description: The Raid set by the user
                    properties:
                      hardwareRAIDVolumes:
                        description: The list of logical disks for hardware RAID,
                          if rootDeviceHints isn't used, first volume is root volume.
                          You can set the value of this field to `[]` to clear all
                          the hardware RAID configurations.
                        items:
                          description: HardwareRAIDVolume defines the desired configuration
                            of volume in hardware RAID
                          properties:
                            controller:
                              description: The name of the RAID controller to use
                              type: string
                            level:
                              description: 'RAID level for the logical disk. The following
                                levels are supported: 0;1;2;5;6;1+0;5+0;6+0.'
                              enum:
                              - "0"
                              - "1"
                              - "2"
                              - "5"
                              - "6"
                              - 1+0
                              - 5+0
                              - 6+0
                              type: string
                            name:
                              description: Name of the volume. Should be unique within
                                the Node. If not specified, volume name will be auto-generated.
                              maxLength: 64
                              type: string
                            numberOfPhysicalDisks:
                              description: Integer, number of physical disks to use
                                for the logical disk. Defaults to minimum number of
                                disks required for the particular RAID level.
                              minimum: 1
                              type: integer
                            physicalDisks:
                              description: Optional list of physical disk names to
                                be used for the Hardware RAID volumes. The disk names
                                are interpreted by the Hardware RAID controller, and
                                the format is hardware specific.
                              items:
                                type: string
                              type: array
                            rotational:
                              description: Select disks with only rotational or solid-state
                                storage
                              type: boolean
                            sizeGibibytes:
                              description: Size (Integer) of the logical disk to be
                                created in GiB. If unspecified or set be 0, the maximum
                                capacity of disk will be used for logical disk.
                              minimum: 0
                              type: integer
                          required:
                          - level
                          type: object
                        nullable: true
                        type: array
                      softwareRAIDVolumes:
                        description: The list of logical disks for software RAID,
                          if rootDeviceHints isn't used, first volume is root volume.
                          If HardwareRAIDVolumes is set this item will be invalid.
                          The number of created Software RAID devices must be 1 or
                          2. If there is only one Software RAID device, it has to
                          be a RAID-1. If there are two, the first one has to be a
                          RAID-1, while the RAID level for the second one can be 0,
                          1, or 1+0. As the first RAID device will be the deployment
                          device, enforcing a RAID-1 reduces the risk of ending up
                          with a non-booting node in case of a disk failure. Software
                          RAID will always be deleted.
                        items:
                          description: SoftwareRAIDVolume defines the desired configuration
                            of volume in software RAID
                          properties:
                            level:
                              description: 'RAID level for the logical disk. The following
                                levels are supported: 0;1;1+0.'
                              enum:
                              - "0"
                              - "1"
                              - 1+0
                              type: string
                            physicalDisks:
                              description: A list of device hints, the number of items
                                should be greater than or equal to 2.
                              items:
                                description: RootDeviceHints holds the hints for specifying
                                  the storage location for the root filesystem for
                                  the image.
                                properties:
                                  deviceName:
                                    description: A Linux device name like "/dev/vda".
                                      The hint must match the actual value exactly.
                                    type: string
                                  hctl:
                                    description: A SCSI bus address like 0:0:0:0.
                                      The hint must match the actual value exactly.
                                    type: string
                                  minSizeGigabytes:
                                    description: The minimum size of the device in
                                      Gigabytes.
                                    minimum: 0
                                    type: integer
                                  model:
                                    description: A vendor-specific device identifier.
                                      The hint can be a substring of the actual value.
                                    type: string
                                  rotational:
                                    description: True if the device should use spinning
                                      media, false otherwise.
                                    type: boolean
                                  serialNumber:
                                    description: Device serial number. The hint must
                                      match the actual value exactly.
                                    type: string
                                  vendor:
                                    description: The name of the vendor or manufacturer
                                      of the device. The hint can be a substring of
                                      the actual value.
                                    type: string
                                  wwn:
                                    description: Unique storage identifier. The hint
                                      must match the actual value exactly.
                                    type: string
                                  wwnVendorExtension:
                                    description: Unique vendor storage identifier.
                                      The hint must match the actual value exactly.
                                    type: string
                                  wwnWithExtension:
                                    description: Unique storage identifier with the
                                      vendor extension appended. The hint must match
                                      the actual value exactly.
                                    type: string
                                type: object
                              minItems: 2
                              type: array
                            sizeGibibytes:
                              description: Size (Integer) of the logical disk to be
                                created in GiB. If unspecified or set be 0, the maximum
                                capacity of disk will be used for logical disk.
                              minimum: 0
                              type: integer
                          required:
                          - level
                          type: object
                        maxItems: 2
                        nullable: true
                        type: array
                    type: object
                  rootDeviceHints:
                    description: The RootDevicehints set by the user
                    properties:
                      deviceName:
                        description: A Linux device name like "/dev/vda". The hint
                          must match the actual value exactly.
                        type: string
                      hctl:
                        description: A SCSI bus address like 0:0:0:0. The hint must
                          match the actual value exactly.
                        type: string
                      minSizeGigabytes:
                        description: The minimum size of the device in Gigabytes.
                        minimum: 0
                        type: integer
                      model:
                        description: A vendor-specific device identifier. The hint
                          can be a substring of the actual value.
                        type: string
                      rotational:
                        description: True if the device should use spinning media,
                          false otherwise.
                        type: boolean
                      serialNumber:
                        description: Device serial number. The hint must match the
                          actual value exactly.
                        type: string
                      vendor:
                        description: The name of the vendor or manufacturer of the
                          device. The hint can be a substring of the actual value.
                        type: string
                      wwn:
                        description: Unique storage identifier. The hint must match
                          the actual value exactly.
                        type: string
                      wwnVendorExtension:
                        description: Unique vendor storage identifier. The hint must
                          match the actual value exactly.
                        type: string
                      wwnWithExtension:
                        description: Unique storage identifier with the vendor extension
                          appended. The hint must match the actual value exactly.
                        type: string
                    type: object
                  state:
                    description: An indiciator for what the provisioner is doing with
                      the host.
                    type: string
                required:
                - ID
                - state
                type: object
              triedCredentials:
                description: the last credentials we sent to the provisioning backend
                properties:
                  credentials:
                    description: SecretReference represents a Secret Reference. It
                      has enough information to retrieve secret in any namespace
                    properties:
                      name:
                        description: Name is unique within a namespace to reference
                          a secret resource.
                        type: string
                      namespace:
                        description: Namespace defines the space within which the
                          secret name must be unique.
                        type: string
                    type: object
                  credentialsVersion:
                    type: string
                type: object
            required:
            - errorCount
            - errorMessage
            - hardwareProfile
            - operationalStatus
            - poweredOn
            - provisioning
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.6.2
  creationTimestamp: null
  name: bmceventsubscriptions.metal3.io
spec:
  group: metal3.io
  names:
    kind: BMCEventSubscription
    listKind: BMCEventSubscriptionList
    plural: bmceventsubscriptions
    shortNames:
    - bes
    - bmcevent
    singular: bmceventsubscription
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The most recent error message
      jsonPath: .status.error
      name: Error
      type: string
    - description: Time duration since creation of BMCEventSubscription
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: BMCEventSubscription is the Schema for the fast eventing API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            properties:
              context:
                description: Arbitrary user-provided context for the event
                type: string
              destination:
                description: A webhook URL to send events to
                type: string
              hostName:
                description: A reference to a BareMetalHost
                type: string
              httpHeadersRef:
                description: A secret containing HTTP headers which should be passed
                  along to the Destination when making a request
                properties:
                  name:
                    description: Name is unique within a namespace to reference a
                      secret resource.
                    type: string
                  namespace:
                    description: Namespace defines the space within which the secret
                      name must be unique.
                    type: string
                type: object
            type: object
          status:
            properties:
              error:
                type: string
              subscriptionID:
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.6.2
  creationTimestamp: null
  name: firmwareschemas.metal3.io
spec:
  group: metal3.io
  names:
    kind: FirmwareSchema
    listKind: FirmwareSchemaList
    plural: firmwareschemas
    singular: firmwareschema
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: FirmwareSchema is the Schema for the firmwareschemas API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: FirmwareSchemaSpec defines the desired state of FirmwareSchema
            properties:
              hardwareModel:
                description: The hardware model associated with this schema
                type: string
              hardwareVendor:
                description: The hardware vendor associated with this schema
                type: string
              schema:
                additionalProperties:
                  description: Additional data describing the firmware setting
                  properties:
                    allowable_values:
                      description: The allowable value for an Enumeration type setting.
                      items:
                        type: string
                      type: array
                    attribute_type:
                      description: The type of setting.
                      enum:
                      - Enumeration
                      - String
                      - Integer
                      - Boolean
                      - Password
                      type: string
                    lower_bound:
                      description: The lowest value for an Integer type setting.
                      type: integer
                    max_length:
                      description: Maximum length for a String type setting.
                      type: integer
                    min_length:
                      description: Minimum length for a String type setting.
                      type: integer
                    read_only:
                      description: Whether or not this setting is read only.
                      type: boolean
                    unique:
                      description: Whether or not this setting's value is unique to
                        this node, e.g. a serial number.
                      type: boolean
                    upper_bound:
                      description: The highest value for an Integer type setting.
                      type: integer
                  type: object
                description: Map of firmware name to schema
                type: object
            required:
            - schema
            type: object
        type: object
    served: true
    storage: true
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.6.2
  creationTimestamp: null
  name: hostfirmwaresettings.metal3.io
spec:
  group: metal3.io
  names:
    kind: HostFirmwareSettings
    listKind: HostFirmwareSettingsList
    plural: hostfirmwaresettings
    shortNames:
    - hfs
    singular: hostfirmwaresettings
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: HostFirmwareSettings is the Schema for the hostfirmwaresettings
          API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: HostFirmwareSettingsSpec defines the desired state of HostFirmwareSettings
            properties:
              settings:
                additionalProperties:
                  anyOf:
                  - type: integer
                  - type: string
                  x-kubernetes-int-or-string: true
                description: Settings are the desired firmware settings stored as
                  name/value pairs.
                type: object
            required:
            - settings
            type: object
          status:
            description: HostFirmwareSettingsStatus defines the observed state of
              HostFirmwareSettings
            properties:
              conditions:
                description: Track whether settings stored in the spec are valid based
                  on the schema
                items:
                  description: "Condition contains details for one aspect of the current
                    state of this API Resource. --- This struct is intended for direct
                    use as an array at the field path .status.conditions.  For example,
                    type FooStatus struct{     // Represents the observations of a
                    foo's current state.     // Known .status.conditions.type are:
                    \"Available\", \"Progressing\", and \"Degraded\"     // +patchMergeKey=type
                    \    // +patchStrategy=merge     // +listType=map     // +listMapKey=type
                    \    Conditions []metav1.Condition `json:\"conditions,omitempty\"
                    patchStrategy:\"merge\" patchMergeKey:\"type\" protobuf:\"bytes,1,rep,name=conditions\"`
                    \n     // other fields }"
                  properties:
                    lastTransitionTime:
                      description: lastTransitionTime is the last time the condition
                        transitioned from one status to another. This should be when
                        the underlying condition changed.  If that is not known, then
                        using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: message is a human readable message indicating
                        details about the transition. This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: observedGeneration represents the .metadata.generation
                        that the condition was set based upon. For instance, if .metadata.generation
                        is currently 12, but the .status.conditions[x].observedGeneration
                        is 9, the condition is out of date with respect to the current
                        state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: reason contains a programmatic identifier indicating
                        the reason for the condition's last transition. Producers
                        of specific condition types may define expected values and
                        meanings for this field, and whether the values are considered
                        a guaranteed API. The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                        --- Many .condition.type values are consistent across resources
                        like Available, but because arbitrary conditions can be useful
                        (see .node.status.conditions), the ability to deconflict is
                        important. The regex it matches is (dns1123SubdomainFmt/)?(qualifiedNameFmt)
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              lastUpdated:
                description: Time that the status was last updated
                format: date-time
                type: string
              schema:
                description: FirmwareSchema is a reference to the Schema used to describe
                  each FirmwareSetting. By default, this will be a Schema in the same
                  Namespace as the settings but it can be overwritten in the Spec
                properties:
                  name:
                    description: '`name` is the reference to the schema.'
                    type: string
                  namespace:
                    description: '`namespace` is the namespace of the where the schema
                      is stored.'
                    type: string
                required:
                - name
                - namespace
                type: object
              settings:
                additionalProperties:
                  type: string
                description: Settings are the firmware settings stored as name/value
                  pairs
                type: object
            required:
            - settings
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.6.2
  creationTimestamp: null
  name: preprovisioningimages.metal3.io
spec:
  group: metal3.io
  names:
    kind: PreprovisioningImage
    listKind: PreprovisioningImageList
    plural: preprovisioningimages
    shortNames:
    - ppimg
    singular: preprovisioningimage
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Whether the image is ready
      jsonPath: .status.conditions[?(@.type=='Ready')].status
      name: Ready
      type: string
    - description: The reason for the image readiness status
      jsonPath: .status.conditions[?(@.type=='Ready')].reason
      name: Reason
      type: string
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: PreprovisioningImage is the Schema for the preprovisioningimages
          API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: PreprovisioningImageSpec defines the desired state of PreprovisioningImage
            properties:
              acceptFormats:
                description: acceptFormats is a list of acceptable image formats.
                items:
                  description: ImageFormat enumerates the allowed image formats
                  enum:
                  - iso
                  - initrd
                  type: string
                type: array
              architecture:
                description: architecture is the processor architecture for which
                  to build the image.
                type: string
              networkDataName:
                description: networkDataName is the name of a Secret in the local
                  namespace that contains network data to build in to the image.
                type: string
            type: object
          status:
            description: PreprovisioningImageStatus defines the observed state of
              PreprovisioningImage
            properties:
              architecture:
                description: architecture is the processor architecture for which
                  the image is built
                type: string
              conditions:
                description: conditions describe the state of the built image
                items:
                  description: "Condition contains details for one aspect of the current
                    state of this API Resource. --- This struct is intended for direct
                    use as an array at the field path .status.conditions.  For example,
                    type FooStatus struct{     // Represents the observations of a
                    foo's current state.     // Known .status.conditions.type are:
                    \"Available\", \"Progressing\", and \"Degraded\"     // +patchMergeKey=type
                    \    // +patchStrategy=merge     // +listType=map     // +listMapKey=type
                    \    Conditions []metav1.Condition `json:\"conditions,omitempty\"
                    patchStrategy:\"merge\" patchMergeKey:\"type\" protobuf:\"bytes,1,rep,name=conditions\"`
                    \n     // other fields }"
                  properties:
                    lastTransitionTime:
                      description: lastTransitionTime is the last time the condition
                        transitioned from one status to another. This should be when
                        the underlying condition changed.  If that is not known, then
                        using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: message is a human readable message indicating
                        details about the transition. This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: observedGeneration represents the .metadata.generation
                        that the condition was set based upon. For instance, if .metadata.generation
                        is currently 12, but the .status.conditions[x].observedGeneration
                        is 9, the condition is out of date with respect to the current
                        state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: reason contains a programmatic identifier indicating
                        the reason for the condition's last transition. Producers
                        of specific condition types may define expected values and
                        meanings for this field, and whether the values are considered
                        a guaranteed API. The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                        --- Many .condition.type values are consistent across resources
                        like Available, but because arbitrary conditions can be useful
                        (see .node.status.conditions), the ability to deconflict is
                        important. The regex it matches is (dns1123SubdomainFmt/)?(qualifiedNameFmt)
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              format:
                description: 'format is the type of image that is available at the
                  download url: either iso or initrd.'
                enum:
                - iso
                - initrd
                type: string
              imageUrl:
                description: imageUrl is the URL from which the built image can be
                  downloaded.
                type: string
              networkData:
                description: networkData is a reference to the version of the Secret
                  containing the network data used to build the image.
                properties:
                  name:
                    type: string
                  version:
                    type: string
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: baremetal-operator-controller-manager
  namespace: baremetal-operator-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: baremetal-operator-leader-election-role
  namespace: baremetal-operator-system
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - ""
  resources:
  - configmaps/status
  verbs:
  - get
  - update
  - patch
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
- apiGroups:
  - coordination.k8s.io
  resources:
  - leases
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  creationTimestamp: null
  name: baremetal-operator-manager-role
rules:
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - get
  - list
  - update
  - watch
- apiGroups:
  - metal3.io
  resources:
  - baremetalhosts
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - metal3.io
  resources:
  - baremetalhosts/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - metal3.io
  resources:
  - bmceventsubscriptions
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - metal3.io
  resources:
  - bmceventsubscriptions/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - metal3.io
  resources:
  - firmwareschemas
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - metal3.io
  resources:
  - firmwareschemas/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - metal3.io
  resources:
  - hostfirmwaresettings
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - metal3.io
  resources:
  - hostfirmwaresettings/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - metal3.io
  resources:
  - preprovisioningimages
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - metal3.io
  resources:
  - preprovisioningimages/status
  verbs:
  - get
  - patch
  - update
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: baremetal-operator-metrics-reader
rules:
- nonResourceURLs:
  - /metrics
  verbs:
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: baremetal-operator-proxy-role
rules:
- apiGroups:
  - authentication.k8s.io
  resources:
  - tokenreviews
  verbs:
  - create
- apiGroups:
  - authorization.k8s.io
  resources:
  - subjectaccessreviews
  verbs:
  - create
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: baremetal-operator-leader-election-rolebinding
  namespace: baremetal-operator-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: baremetal-operator-leader-election-role
subjects:
- kind: ServiceAccount
  name: baremetal-operator-controller-manager
  namespace: baremetal-operator-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: baremetal-operator-manager-rolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: baremetal-operator-manager-role
subjects:
- kind: ServiceAccount
  name: baremetal-operator-controller-manager
  namespace: baremetal-operator-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: baremetal-operator-proxy-rolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: baremetal-operator-proxy-role
subjects:
- kind: ServiceAccount
  name: baremetal-operator-controller-manager
  namespace: baremetal-operator-system
---
apiVersion: v1
data:
  CACHEURL: http://172.22.0.1/images
  DEPLOY_KERNEL_URL: http://172.22.0.2:6180/images/ironic-python-agent.kernel
  DEPLOY_RAMDISK_URL: http://172.22.0.2:6180/images/ironic-python-agent.initramfs
  DHCP_RANGE: 172.22.0.10,172.22.0.100
  HTTP_PORT: "6180"
  IRONIC_ENDPOINT: http://172.22.0.2:6385/v1/
  IRONIC_FAST_TRACK: "true"
  IRONIC_INSPECTOR_ENDPOINT: http://172.22.0.2:5050/v1/
  PROVISIONING_INTERFACE: eth2
kind: ConfigMap
metadata:
  name: baremetal-operator-ironic
  namespace: baremetal-operator-system
---
apiVersion: v1
data:
  controller_manager_config.yaml: |
    apiVersion: controller-runtime.sigs.k8s.io/v1alpha1
    kind: ControllerManagerConfig
    health:
      healthProbeBindAddress: :9440
    metrics:
      bindAddress: 127.0.0.1:8085
    webhook:
      port: 9443
    leaderElection:
      leaderElect: true
      resourceName: a9498140.metal3.io
kind: ConfigMap
metadata:
  name: baremetal-operator-manager-config
  namespace: baremetal-operator-system
---
apiVersion: v1
kind: Service
metadata:
  labels:
    control-plane: controller-manager
  name: baremetal-operator-controller-manager-metrics-service
  namespace: baremetal-operator-system
spec:
  ports:
  - name: https
    port: 8443
    targetPort: https
  selector:
    control-plane: controller-manager
---
apiVersion: v1
kind: Service
metadata:
  name: baremetal-operator-webhook-service
  namespace: baremetal-operator-system
spec:
  ports:
  - port: 443
    targetPort: 9443
  selector:
    control-plane: controller-manager
    webhook: metal3-io-v1alpha1-baremetalhost
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    control-plane: controller-manager
    webhook: metal3-io-v1alpha1-baremetalhost
  name: baremetal-operator-controller-manager
  namespace: baremetal-operator-system
spec:
  replicas: 1
  selector:
    matchLabels:
      control-plane: controller-manager
  template:
    metadata:
      labels:
        control-plane: controller-manager
        webhook: metal3-io-v1alpha1-baremetalhost
    spec:
      containers:
      - args:
        - --metrics-addr=127.0.0.1:8085
        - --enable-leader-election
        command:
        - /baremetal-operator
        env:
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        envFrom:
        - configMapRef:
            name: baremetal-operator-ironic
        image: quay.io/metal3-io/baremetal-operator
        imagePullPolicy: Always
        livenessProbe:
          failureThreshold: 10
          httpGet:
            path: /healthz
            port: 9440
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 2
        name: manager
        ports:
        - containerPort: 9443
          name: webhook-server
          protocol: TCP
        readinessProbe:
          failureThreshold: 10
          httpGet:
            path: /readyz
            port: 9440
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 2
        securityContext:
          allowPrivilegeEscalation: false
        volumeMounts:
        - mountPath: /tmp/k8s-webhook-server/serving-certs
          name: cert
          readOnly: true
      - args:
        - --secure-listen-address=0.0.0.0:8443
        - --upstream=http://127.0.0.1:8085/
        - --logtostderr=true
        - --v=10
        image: gcr.io/kubebuilder/kube-rbac-proxy:v0.8.0
        name: kube-rbac-proxy
        ports:
        - containerPort: 8443
          name: https
      serviceAccountName: baremetal-operator-controller-manager
      terminationGracePeriodSeconds: 10
      volumes:
      - name: cert
        secret:
          defaultMode: 420
          secretName: bmo-webhook-server-cert
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: baremetal-operator-serving-cert
  namespace: baremetal-operator-system
spec:
  dnsNames:
  - baremetal-operator-webhook-service.baremetal-operator-system.svc
  - baremetal-operator-webhook-service.baremetal-operator-system.svc.cluster.local
  issuerRef:
    kind: Issuer
    name: baremetal-operator-selfsigned-issuer
  secretName: bmo-webhook-server-cert
---
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  name: baremetal-operator-selfsigned-issuer
  namespace: baremetal-operator-system
spec:
  selfSigned: {}
---
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  annotations:
    cert-manager.io/inject-ca-from: baremetal-operator-system/baremetal-operator-serving-cert
  name: baremetal-operator-validating-webhook-configuration
webhooks:
- admissionReviewVersions:
  - v1
  - v1beta
  clientConfig:
    service:
      name: baremetal-operator-webhook-service
      namespace: baremetal-operator-system
      path: /validate-metal3-io-v1alpha1-baremetalhost
  failurePolicy: Fail
  name: baremetalhost.metal3.io
  rules:
  - apiGroups:
    - metal3.io
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - baremetalhosts
  sideEffects: None
- admissionReviewVersions:
  - v1
  - v1beta
  clientConfig:
    service:
      name: baremetal-operator-webhook-service
      namespace: baremetal-operator-system
      path: /validate-metal3-io-v1alpha1-bmceventsubscription
  failurePolicy: Fail
  name: bmceventsubscription.metal3.io
  rules:
  - apiGroups:
    - metal3.io
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - bmceventsubscriptions
  sideEffects: None
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: controller-manager
  namespace: system
spec:
  template:
    spec:
      containers:
      - name: manager
        volumeMounts:
          - name: cacert
            mountPath: "/opt/metal3/certs/ca"
            readOnly: true
      volumes:
      - name: cacert
        secret:
          secretName: ironic-cacert---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: baremetal-operator-system
resources:
- ../default
- ../namespace

patchesStrategicMerge:
- tls_ca_patch.yaml
---
apiVersion: v1
kind: Namespace
metadata:
  labels:
    control-plane: controller-manager
  name: baremetal-operator-system---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- namespace.yaml---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

bases:
- namespace
- default
---
apiVersion: controller-runtime.sigs.k8s.io/v1alpha1
kind: ControllerManagerConfig
health:
  healthProbeBindAddress: :9440
metrics:
  bindAddress: 127.0.0.1:8085
webhook:
  port: 9443
leaderElection:
  leaderElect: true
  resourceName: a9498140.metal3.io
---
resources:
- manager.yaml

generatorOptions:
  disableNameSuffixHash: true

configMapGenerator:
- name: manager-config
  files:
  - controller_manager_config.yaml
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: controller-manager
  namespace: system
  labels:
    control-plane: controller-manager
    webhook: metal3-io-v1alpha1-baremetalhost
spec:
  selector:
    matchLabels:
      control-plane: controller-manager
  replicas: 1
  template:
    metadata:
      labels:
        control-plane: controller-manager
        webhook: metal3-io-v1alpha1-baremetalhost
    spec:
      containers:
      - command:
        - /baremetal-operator
        args:
        - --enable-leader-election
        image: quay.io/metal3-io/baremetal-operator
        imagePullPolicy: Always
        env:
          - name: POD_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          - name: POD_NAMESPACE
            valueFrom:
              fieldRef:
                fieldPath: metadata.namespace
        envFrom:
          - configMapRef:
              name: ironic
        name: manager
        securityContext:
          allowPrivilegeEscalation: false
        livenessProbe:
          httpGet:
            path: /healthz
            port: 9440
          initialDelaySeconds: 10
          periodSeconds: 10
          timeoutSeconds: 2
          successThreshold: 1
          failureThreshold: 10
        readinessProbe:
          httpGet:
            path: /readyz
            port: 9440
          initialDelaySeconds: 10
          periodSeconds: 10
          timeoutSeconds: 2
          successThreshold: 1
          failureThreshold: 10
      serviceAccountName: controller-manager
      terminationGracePeriodSeconds: 10
---

---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.6.2
  creationTimestamp: null
  name: bmceventsubscriptions.metal3.io
spec:
  group: metal3.io
  names:
    kind: BMCEventSubscription
    listKind: BMCEventSubscriptionList
    plural: bmceventsubscriptions
    shortNames:
    - bes
    - bmcevent
    singular: bmceventsubscription
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The most recent error message
      jsonPath: .status.error
      name: Error
      type: string
    - description: Time duration since creation of BMCEventSubscription
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: BMCEventSubscription is the Schema for the fast eventing API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            properties:
              context:
                description: Arbitrary user-provided context for the event
                type: string
              destination:
                description: A webhook URL to send events to
                type: string
              hostName:
                description: A reference to a BareMetalHost
                type: string
              httpHeadersRef:
                description: A secret containing HTTP headers which should be passed
                  along to the Destination when making a request
                properties:
                  name:
                    description: Name is unique within a namespace to reference a
                      secret resource.
                    type: string
                  namespace:
                    description: Namespace defines the space within which the secret
                      name must be unique.
                    type: string
                type: object
            type: object
          status:
            properties:
              error:
                type: string
              subscriptionID:
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---

---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.6.2
  creationTimestamp: null
  name: firmwareschemas.metal3.io
spec:
  group: metal3.io
  names:
    kind: FirmwareSchema
    listKind: FirmwareSchemaList
    plural: firmwareschemas
    singular: firmwareschema
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: FirmwareSchema is the Schema for the firmwareschemas API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: FirmwareSchemaSpec defines the desired state of FirmwareSchema
            properties:
              hardwareModel:
                description: The hardware model associated with this schema
                type: string
              hardwareVendor:
                description: The hardware vendor associated with this schema
                type: string
              schema:
                additionalProperties:
                  description: Additional data describing the firmware setting
                  properties:
                    allowable_values:
                      description: The allowable value for an Enumeration type setting.
                      items:
                        type: string
                      type: array
                    attribute_type:
                      description: The type of setting.
                      enum:
                      - Enumeration
                      - String
                      - Integer
                      - Boolean
                      - Password
                      type: string
                    lower_bound:
                      description: The lowest value for an Integer type setting.
                      type: integer
                    max_length:
                      description: Maximum length for a String type setting.
                      type: integer
                    min_length:
                      description: Minimum length for a String type setting.
                      type: integer
                    read_only:
                      description: Whether or not this setting is read only.
                      type: boolean
                    unique:
                      description: Whether or not this setting's value is unique to
                        this node, e.g. a serial number.
                      type: boolean
                    upper_bound:
                      description: The highest value for an Integer type setting.
                      type: integer
                  type: object
                description: Map of firmware name to schema
                type: object
            required:
            - schema
            type: object
        type: object
    served: true
    storage: true
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---

---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.6.2
  creationTimestamp: null
  name: preprovisioningimages.metal3.io
spec:
  group: metal3.io
  names:
    kind: PreprovisioningImage
    listKind: PreprovisioningImageList
    plural: preprovisioningimages
    shortNames:
    - ppimg
    singular: preprovisioningimage
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Whether the image is ready
      jsonPath: .status.conditions[?(@.type=='Ready')].status
      name: Ready
      type: string
    - description: The reason for the image readiness status
      jsonPath: .status.conditions[?(@.type=='Ready')].reason
      name: Reason
      type: string
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: PreprovisioningImage is the Schema for the preprovisioningimages
          API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: PreprovisioningImageSpec defines the desired state of PreprovisioningImage
            properties:
              acceptFormats:
                description: acceptFormats is a list of acceptable image formats.
                items:
                  description: ImageFormat enumerates the allowed image formats
                  enum:
                  - iso
                  - initrd
                  type: string
                type: array
              architecture:
                description: architecture is the processor architecture for which
                  to build the image.
                type: string
              networkDataName:
                description: networkDataName is the name of a Secret in the local
                  namespace that contains network data to build in to the image.
                type: string
            type: object
          status:
            description: PreprovisioningImageStatus defines the observed state of
              PreprovisioningImage
            properties:
              architecture:
                description: architecture is the processor architecture for which
                  the image is built
                type: string
              conditions:
                description: conditions describe the state of the built image
                items:
                  description: "Condition contains details for one aspect of the current
                    state of this API Resource. --- This struct is intended for direct
                    use as an array at the field path .status.conditions.  For example,
                    type FooStatus struct{     // Represents the observations of a
                    foo's current state.     // Known .status.conditions.type are:
                    \"Available\", \"Progressing\", and \"Degraded\"     // +patchMergeKey=type
                    \    // +patchStrategy=merge     // +listType=map     // +listMapKey=type
                    \    Conditions []metav1.Condition `json:\"conditions,omitempty\"
                    patchStrategy:\"merge\" patchMergeKey:\"type\" protobuf:\"bytes,1,rep,name=conditions\"`
                    \n     // other fields }"
                  properties:
                    lastTransitionTime:
                      description: lastTransitionTime is the last time the condition
                        transitioned from one status to another. This should be when
                        the underlying condition changed.  If that is not known, then
                        using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: message is a human readable message indicating
                        details about the transition. This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: observedGeneration represents the .metadata.generation
                        that the condition was set based upon. For instance, if .metadata.generation
                        is currently 12, but the .status.conditions[x].observedGeneration
                        is 9, the condition is out of date with respect to the current
                        state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: reason contains a programmatic identifier indicating
                        the reason for the condition's last transition. Producers
                        of specific condition types may define expected values and
                        meanings for this field, and whether the values are considered
                        a guaranteed API. The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                        --- Many .condition.type values are consistent across resources
                        like Available, but because arbitrary conditions can be useful
                        (see .node.status.conditions), the ability to deconflict is
                        important. The regex it matches is (dns1123SubdomainFmt/)?(qualifiedNameFmt)
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              format:
                description: 'format is the type of image that is available at the
                  download url: either iso or initrd.'
                enum:
                - iso
                - initrd
                type: string
              imageUrl:
                description: imageUrl is the URL from which the built image can be
                  downloaded.
                type: string
              networkData:
                description: networkData is a reference to the version of the Secret
                  containing the network data used to build the image.
                properties:
                  name:
                    type: string
                  version:
                    type: string
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---

---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.6.2
  creationTimestamp: null
  name: hostfirmwaresettings.metal3.io
spec:
  group: metal3.io
  names:
    kind: HostFirmwareSettings
    listKind: HostFirmwareSettingsList
    plural: hostfirmwaresettings
    shortNames:
    - hfs
    singular: hostfirmwaresettings
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: HostFirmwareSettings is the Schema for the hostfirmwaresettings
          API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: HostFirmwareSettingsSpec defines the desired state of HostFirmwareSettings
            properties:
              settings:
                additionalProperties:
                  anyOf:
                  - type: integer
                  - type: string
                  x-kubernetes-int-or-string: true
                description: Settings are the desired firmware settings stored as
                  name/value pairs.
                type: object
            required:
            - settings
            type: object
          status:
            description: HostFirmwareSettingsStatus defines the observed state of
              HostFirmwareSettings
            properties:
              conditions:
                description: Track whether settings stored in the spec are valid based
                  on the schema
                items:
                  description: "Condition contains details for one aspect of the current
                    state of this API Resource. --- This struct is intended for direct
                    use as an array at the field path .status.conditions.  For example,
                    type FooStatus struct{     // Represents the observations of a
                    foo's current state.     // Known .status.conditions.type are:
                    \"Available\", \"Progressing\", and \"Degraded\"     // +patchMergeKey=type
                    \    // +patchStrategy=merge     // +listType=map     // +listMapKey=type
                    \    Conditions []metav1.Condition `json:\"conditions,omitempty\"
                    patchStrategy:\"merge\" patchMergeKey:\"type\" protobuf:\"bytes,1,rep,name=conditions\"`
                    \n     // other fields }"
                  properties:
                    lastTransitionTime:
                      description: lastTransitionTime is the last time the condition
                        transitioned from one status to another. This should be when
                        the underlying condition changed.  If that is not known, then
                        using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: message is a human readable message indicating
                        details about the transition. This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: observedGeneration represents the .metadata.generation
                        that the condition was set based upon. For instance, if .metadata.generation
                        is currently 12, but the .status.conditions[x].observedGeneration
                        is 9, the condition is out of date with respect to the current
                        state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: reason contains a programmatic identifier indicating
                        the reason for the condition's last transition. Producers
                        of specific condition types may define expected values and
                        meanings for this field, and whether the values are considered
                        a guaranteed API. The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                        --- Many .condition.type values are consistent across resources
                        like Available, but because arbitrary conditions can be useful
                        (see .node.status.conditions), the ability to deconflict is
                        important. The regex it matches is (dns1123SubdomainFmt/)?(qualifiedNameFmt)
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              lastUpdated:
                description: Time that the status was last updated
                format: date-time
                type: string
              schema:
                description: FirmwareSchema is a reference to the Schema used to describe
                  each FirmwareSetting. By default, this will be a Schema in the same
                  Namespace as the settings but it can be overwritten in the Spec
                properties:
                  name:
                    description: '`name` is the reference to the schema.'
                    type: string
                  namespace:
                    description: '`namespace` is the namespace of the where the schema
                      is stored.'
                    type: string
                required:
                - name
                - namespace
                type: object
              settings:
                additionalProperties:
                  type: string
                description: Settings are the firmware settings stored as name/value
                  pairs
                type: object
            required:
            - settings
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---

---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.6.2
  creationTimestamp: null
  name: baremetalhosts.metal3.io
spec:
  group: metal3.io
  names:
    kind: BareMetalHost
    listKind: BareMetalHostList
    plural: baremetalhosts
    shortNames:
    - bmh
    - bmhost
    singular: baremetalhost
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Operational status
      jsonPath: .status.operationalStatus
      name: Status
      priority: 1
      type: string
    - description: Provisioning status
      jsonPath: .status.provisioning.state
      name: State
      type: string
    - description: Consumer using this host
      jsonPath: .spec.consumerRef.name
      name: Consumer
      type: string
    - description: Address of management controller
      jsonPath: .spec.bmc.address
      name: BMC
      priority: 1
      type: string
    - description: The type of hardware detected
      jsonPath: .status.hardwareProfile
      name: Hardware_Profile
      priority: 1
      type: string
    - description: Whether the host is online or not
      jsonPath: .spec.online
      name: Online
      type: string
    - description: Type of the most recent error
      jsonPath: .status.errorType
      name: Error
      type: string
    - description: Time duration since creation of BaremetalHost
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: BareMetalHost is the Schema for the baremetalhosts API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: BareMetalHostSpec defines the desired state of BareMetalHost
            properties:
              automatedCleaningMode:
                default: metadata
                description: When set to disabled, automated cleaning will be avoided
                  during provisioning and deprovisioning.
                enum:
                - metadata
                - disabled
                type: string
              bmc:
                description: How do we connect to the BMC?
                properties:
                  address:
                    description: Address holds the URL for accessing the controller
                      on the network.
                    type: string
                  credentialsName:
                    description: The name of the secret containing the BMC credentials
                      (requires keys "username" and "password").
                    type: string
                  disableCertificateVerification:
                    description: DisableCertificateVerification disables verification
                      of server certificates when using HTTPS to connect to the BMC.
                      This is required when the server certificate is self-signed,
                      but is insecure because it allows a man-in-the-middle to intercept
                      the connection.
                    type: boolean
                required:
                - address
                - credentialsName
                type: object
              bootMACAddress:
                description: Which MAC address will PXE boot? This is optional for
                  some types, but required for libvirt VMs driven by vbmc.
                pattern: '[0-9a-fA-F]{2}(:[0-9a-fA-F]{2}){5}'
                type: string
              bootMode:
                description: Select the method of initializing the hardware during
                  boot. Defaults to UEFI.
                enum:
                - UEFI
                - UEFISecureBoot
                - legacy
                type: string
              consumerRef:
                description: ConsumerRef can be used to store information about something
                  that is using a host. When it is not empty, the host is considered
                  "in use".
                properties:
                  apiVersion:
                    description: API version of the referent.
                    type: string
                  fieldPath:
                    description: 'If referring to a piece of an object instead of
                      an entire object, this string should contain a valid JSON/Go
                      field access statement, such as desiredState.manifest.containers[2].
                      For example, if the object reference is to a container within
                      a pod, this would take on a value like: "spec.containers{name}"
                      (where "name" refers to the name of the container that triggered
                      the event) or if no container name is specified "spec.containers[2]"
                      (container with index 2 in this pod). This syntax is chosen
                      only to have some well-defined way of referencing a part of
                      an object. TODO: this design is not final and this field is
                      subject to change in the future.'
                    type: string
                  kind:
                    description: 'Kind of the referent. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
                    type: string
                  name:
                    description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names'
                    type: string
                  namespace:
                    description: 'Namespace of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/'
                    type: string
                  resourceVersion:
                    description: 'Specific resourceVersion to which this reference
                      is made, if any. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency'
                    type: string
                  uid:
                    description: 'UID of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids'
                    type: string
                type: object
              customDeploy:
                description: A custom deploy procedure.
                properties:
                  method:
                    description: Custom deploy method name. This name is specific
                      to the deploy ramdisk used. If you don't have a custom deploy
                      ramdisk, you shouldn't use CustomDeploy.
                    type: string
                required:
                - method
                type: object
              description:
                description: Description is a human-entered text used to help identify
                  the host
                type: string
              externallyProvisioned:
                description: ExternallyProvisioned means something else is managing
                  the image running on the host and the operator should only manage
                  the power status and hardware inventory inspection. If the Image
                  field is filled in, this field is ignored.
                type: boolean
              firmware:
                description: BIOS configuration for bare metal server
                properties:
                  simultaneousMultithreadingEnabled:
                    description: 'Allows a single physical processor core to appear
                      as several logical processors. This supports following options:
                      true, false.'
                    enum:
                    - true
                    - false
                    type: boolean
                  sriovEnabled:
                    description: 'SR-IOV support enables a hypervisor to create virtual
                      instances of a PCI-express device, potentially increasing performance.
                      This supports following options: true, false.'
                    enum:
                    - true
                    - false
                    type: boolean
                  virtualizationEnabled:
                    description: 'Supports the virtualization of platform hardware.
                      This supports following options: true, false.'
                    enum:
                    - true
                    - false
                    type: boolean
                type: object
              hardwareProfile:
                description: What is the name of the hardware profile for this host?
                  It should only be necessary to set this when inspection cannot automatically
                  determine the profile.
                type: string
              image:
                description: Image holds the details of the image to be provisioned.
                properties:
                  checksum:
                    description: Checksum is the checksum for the image.
                    type: string
                  checksumType:
                    description: ChecksumType is the checksum algorithm for the image.
                      e.g md5, sha256, sha512
                    enum:
                    - md5
                    - sha256
                    - sha512
                    type: string
                  format:
                    description: DiskFormat contains the format of the image (raw,
                      qcow2, ...). Needs to be set to raw for raw images streaming.
                      Note live-iso means an iso referenced by the url will be live-booted
                      and not deployed to disk, and in this case the checksum options
                      are not required and if specified will be ignored.
                    enum:
                    - raw
                    - qcow2
                    - vdi
                    - vmdk
                    - live-iso
                    type: string
                  url:
                    description: URL is a location of an image to deploy.
                    type: string
                required:
                - url
                type: object
              metaData:
                description: MetaData holds the reference to the Secret containing
                  host metadata (e.g. meta_data.json) which is passed to the Config
                  Drive.
                properties:
                  name:
                    description: Name is unique within a namespace to reference a
                      secret resource.
                    type: string
                  namespace:
                    description: Namespace defines the space within which the secret
                      name must be unique.
                    type: string
                type: object
              networkData:
                description: NetworkData holds the reference to the Secret containing
                  network configuration (e.g content of network_data.json) which is
                  passed to the Config Drive.
                properties:
                  name:
                    description: Name is unique within a namespace to reference a
                      secret resource.
                    type: string
                  namespace:
                    description: Namespace defines the space within which the secret
                      name must be unique.
                    type: string
                type: object
              online:
                description: Should the server be online?
                type: boolean
              preprovisioningNetworkDataName:
                description: PreprovisioningNetworkDataName is the name of the Secret
                  in the local namespace containing network configuration (e.g content
                  of network_data.json) which is passed to the preprovisioning image,
                  and to the Config Drive if not overridden by specifying NetworkData.
                type: string
              raid:
                description: RAID configuration for bare metal server
                properties:
                  hardwareRAIDVolumes:
                    description: The list of logical disks for hardware RAID, if rootDeviceHints
                      isn't used, first volume is root volume. You can set the value
                      of this field to `[]` to clear all the hardware RAID configurations.
                    items:
                      description: HardwareRAIDVolume defines the desired configuration
                        of volume in hardware RAID
                      properties:
                        controller:
                          description: The name of the RAID controller to use
                          type: string
                        level:
                          description: 'RAID level for the logical disk. The following
                            levels are supported: 0;1;2;5;6;1+0;5+0;6+0.'
                          enum:
                          - "0"
                          - "1"
                          - "2"
                          - "5"
                          - "6"
                          - 1+0
                          - 5+0
                          - 6+0
                          type: string
                        name:
                          description: Name of the volume. Should be unique within
                            the Node. If not specified, volume name will be auto-generated.
                          maxLength: 64
                          type: string
                        numberOfPhysicalDisks:
                          description: Integer, number of physical disks to use for
                            the logical disk. Defaults to minimum number of disks
                            required for the particular RAID level.
                          minimum: 1
                          type: integer
                        physicalDisks:
                          description: Optional list of physical disk names to be
                            used for the Hardware RAID volumes. The disk names are
                            interpreted by the Hardware RAID controller, and the format
                            is hardware specific.
                          items:
                            type: string
                          type: array
                        rotational:
                          description: Select disks with only rotational or solid-state
                            storage
                          type: boolean
                        sizeGibibytes:
                          description: Size (Integer) of the logical disk to be created
                            in GiB. If unspecified or set be 0, the maximum capacity
                            of disk will be used for logical disk.
                          minimum: 0
                          type: integer
                      required:
                      - level
                      type: object
                    nullable: true
                    type: array
                  softwareRAIDVolumes:
                    description: The list of logical disks for software RAID, if rootDeviceHints
                      isn't used, first volume is root volume. If HardwareRAIDVolumes
                      is set this item will be invalid. The number of created Software
                      RAID devices must be 1 or 2. If there is only one Software RAID
                      device, it has to be a RAID-1. If there are two, the first one
                      has to be a RAID-1, while the RAID level for the second one
                      can be 0, 1, or 1+0. As the first RAID device will be the deployment
                      device, enforcing a RAID-1 reduces the risk of ending up with
                      a non-booting node in case of a disk failure. Software RAID
                      will always be deleted.
                    items:
                      description: SoftwareRAIDVolume defines the desired configuration
                        of volume in software RAID
                      properties:
                        level:
                          description: 'RAID level for the logical disk. The following
                            levels are supported: 0;1;1+0.'
                          enum:
                          - "0"
                          - "1"
                          - 1+0
                          type: string
                        physicalDisks:
                          description: A list of device hints, the number of items
                            should be greater than or equal to 2.
                          items:
                            description: RootDeviceHints holds the hints for specifying
                              the storage location for the root filesystem for the
                              image.
                            properties:
                              deviceName:
                                description: A Linux device name like "/dev/vda".
                                  The hint must match the actual value exactly.
                                type: string
                              hctl:
                                description: A SCSI bus address like 0:0:0:0. The
                                  hint must match the actual value exactly.
                                type: string
                              minSizeGigabytes:
                                description: The minimum size of the device in Gigabytes.
                                minimum: 0
                                type: integer
                              model:
                                description: A vendor-specific device identifier.
                                  The hint can be a substring of the actual value.
                                type: string
                              rotational:
                                description: True if the device should use spinning
                                  media, false otherwise.
                                type: boolean
                              serialNumber:
                                description: Device serial number. The hint must match
                                  the actual value exactly.
                                type: string
                              vendor:
                                description: The name of the vendor or manufacturer
                                  of the device. The hint can be a substring of the
                                  actual value.
                                type: string
                              wwn:
                                description: Unique storage identifier. The hint must
                                  match the actual value exactly.
                                type: string
                              wwnVendorExtension:
                                description: Unique vendor storage identifier. The
                                  hint must match the actual value exactly.
                                type: string
                              wwnWithExtension:
                                description: Unique storage identifier with the vendor
                                  extension appended. The hint must match the actual
                                  value exactly.
                                type: string
                            type: object
                          minItems: 2
                          type: array
                        sizeGibibytes:
                          description: Size (Integer) of the logical disk to be created
                            in GiB. If unspecified or set be 0, the maximum capacity
                            of disk will be used for logical disk.
                          minimum: 0
                          type: integer
                      required:
                      - level
                      type: object
                    maxItems: 2
                    nullable: true
                    type: array
                type: object
              rootDeviceHints:
                description: Provide guidance about how to choose the device for the
                  image being provisioned.
                properties:
                  deviceName:
                    description: A Linux device name like "/dev/vda". The hint must
                      match the actual value exactly.
                    type: string
                  hctl:
                    description: A SCSI bus address like 0:0:0:0. The hint must match
                      the actual value exactly.
                    type: string
                  minSizeGigabytes:
                    description: The minimum size of the device in Gigabytes.
                    minimum: 0
                    type: integer
                  model:
                    description: A vendor-specific device identifier. The hint can
                      be a substring of the actual value.
                    type: string
                  rotational:
                    description: True if the device should use spinning media, false
                      otherwise.
                    type: boolean
                  serialNumber:
                    description: Device serial number. The hint must match the actual
                      value exactly.
                    type: string
                  vendor:
                    description: The name of the vendor or manufacturer of the device.
                      The hint can be a substring of the actual value.
                    type: string
                  wwn:
                    description: Unique storage identifier. The hint must match the
                      actual value exactly.
                    type: string
                  wwnVendorExtension:
                    description: Unique vendor storage identifier. The hint must match
                      the actual value exactly.
                    type: string
                  wwnWithExtension:
                    description: Unique storage identifier with the vendor extension
                      appended. The hint must match the actual value exactly.
                    type: string
                type: object
              taints:
                description: Taints is the full, authoritative list of taints to apply
                  to the corresponding Machine. This list will overwrite any modifications
                  made to the Machine on an ongoing basis.
                items:
                  description: The node this Taint is attached to has the "effect"
                    on any pod that does not tolerate the Taint.
                  properties:
                    effect:
                      description: Required. The effect of the taint on pods that
                        do not tolerate the taint. Valid effects are NoSchedule, PreferNoSchedule
                        and NoExecute.
                      type: string
                    key:
                      description: Required. The taint key to be applied to a node.
                      type: string
                    timeAdded:
                      description: TimeAdded represents the time at which the taint
                        was added. It is only written for NoExecute taints.
                      format: date-time
                      type: string
                    value:
                      description: The taint value corresponding to the taint key.
                      type: string
                  required:
                  - effect
                  - key
                  type: object
                type: array
              userData:
                description: UserData holds the reference to the Secret containing
                  the user data to be passed to the host before it boots.
                properties:
                  name:
                    description: Name is unique within a namespace to reference a
                      secret resource.
                    type: string
                  namespace:
                    description: Namespace defines the space within which the secret
                      name must be unique.
                    type: string
                type: object
            required:
            - online
            type: object
          status:
            description: BareMetalHostStatus defines the observed state of BareMetalHost
            properties:
              errorCount:
                default: 0
                description: ErrorCount records how many times the host has encoutered
                  an error since the last successful operation
                type: integer
              errorMessage:
                description: the last error message reported by the provisioning subsystem
                type: string
              errorType:
                description: ErrorType indicates the type of failure encountered when
                  the OperationalStatus is OperationalStatusError
                enum:
                - provisioned registration error
                - registration error
                - inspection error
                - preparation error
                - provisioning error
                - power management error
                type: string
              goodCredentials:
                description: the last credentials we were able to validate as working
                properties:
                  credentials:
                    description: SecretReference represents a Secret Reference. It
                      has enough information to retrieve secret in any namespace
                    properties:
                      name:
                        description: Name is unique within a namespace to reference
                          a secret resource.
                        type: string
                      namespace:
                        description: Namespace defines the space within which the
                          secret name must be unique.
                        type: string
                    type: object
                  credentialsVersion:
                    type: string
                type: object
              hardware:
                description: The hardware discovered to exist on the host.
                properties:
                  cpu:
                    description: CPU describes one processor on the host.
                    properties:
                      arch:
                        type: string
                      clockMegahertz:
                        description: ClockSpeed is a clock speed in MHz
                        format: double
                        type: number
                      count:
                        type: integer
                      flags:
                        items:
                          type: string
                        type: array
                      model:
                        type: string
                    type: object
                  firmware:
                    description: Firmware describes the firmware on the host.
                    properties:
                      bios:
                        description: The BIOS for this firmware
                        properties:
                          date:
                            description: The release/build date for this BIOS
                            type: string
                          vendor:
                            description: The vendor name for this BIOS
                            type: string
                          version:
                            description: The version of the BIOS
                            type: string
                        type: object
                    type: object
                  hostname:
                    type: string
                  nics:
                    items:
                      description: NIC describes one network interface on the host.
                      properties:
                        ip:
                          description: The IP address of the interface. This will
                            be an IPv4 or IPv6 address if one is present.  If both
                            IPv4 and IPv6 addresses are present in a dual-stack environment,
                            two nics will be output, one with each IP.
                          type: string
                        mac:
                          description: The device MAC address
                          pattern: '[0-9a-fA-F]{2}(:[0-9a-fA-F]{2}){5}'
                          type: string
                        model:
                          description: The vendor and product IDs of the NIC, e.g.
                            "0x8086 0x1572"
                          type: string
                        name:
                          description: The name of the network interface, e.g. "en0"
                          type: string
                        pxe:
                          description: Whether the NIC is PXE Bootable
                          type: boolean
                        speedGbps:
                          description: The speed of the device in Gigabits per second
                          type: integer
                        vlanId:
                          description: The untagged VLAN ID
                          format: int32
                          maximum: 4094
                          minimum: 0
                          type: integer
                        vlans:
                          description: The VLANs available
                          items:
                            description: VLAN represents the name and ID of a VLAN
                            properties:
                              id:
                                description: VLANID is a 12-bit 802.1Q VLAN identifier
                                format: int32
                                maximum: 4094
                                minimum: 0
                                type: integer
                              name:
                                type: string
                            type: object
                          type: array
                      type: object
                    type: array
                  ramMebibytes:
                    type: integer
                  storage:
                    items:
                      description: Storage describes one storage device (disk, SSD,
                        etc.) on the host.
                      properties:
                        hctl:
                          description: The SCSI location of the device
                          type: string
                        model:
                          description: Hardware model
                          type: string
                        name:
                          description: The Linux device name of the disk, e.g. "/dev/sda".
                            Note that this may not be stable across reboots.
                          type: string
                        rotational:
                          description: Whether this disk represents rotational storage.
                            This field is not recommended for usage, please prefer
                            using 'Type' field instead, this field will be deprecated
                            eventually.
                          type: boolean
                        serialNumber:
                          description: The serial number of the device
                          type: string
                        sizeBytes:
                          description: The size of the disk in Bytes
                          format: int64
                          type: integer
                        type:
                          description: 'Device type, one of: HDD, SSD, NVME.'
                          enum:
                          - HDD
                          - SSD
                          - NVME
                          type: string
                        vendor:
                          description: The name of the vendor of the device
                          type: string
                        wwn:
                          description: The WWN of the device
                          type: string
                        wwnVendorExtension:
                          description: The WWN Vendor extension of the device
                          type: string
                        wwnWithExtension:
                          description: The WWN with the extension
                          type: string
                      type: object
                    type: array
                  systemVendor:
                    description: HardwareSystemVendor stores details about the whole
                      hardware system.
                    properties:
                      manufacturer:
                        type: string
                      productName:
                        type: string
                      serialNumber:
                        type: string
                    type: object
                type: object
              hardwareProfile:
                description: The name of the profile matching the hardware details.
                type: string
              lastUpdated:
                description: LastUpdated identifies when this status was last observed.
                format: date-time
                type: string
              operationHistory:
                description: OperationHistory holds information about operations performed
                  on this host.
                properties:
                  deprovision:
                    description: OperationMetric contains metadata about an operation
                      (inspection, provisioning, etc.) used for tracking metrics.
                    properties:
                      end:
                        format: date-time
                        nullable: true
                        type: string
                      start:
                        format: date-time
                        nullable: true
                        type: string
                    type: object
                  inspect:
                    description: OperationMetric contains metadata about an operation
                      (inspection, provisioning, etc.) used for tracking metrics.
                    properties:
                      end:
                        format: date-time
                        nullable: true
                        type: string
                      start:
                        format: date-time
                        nullable: true
                        type: string
                    type: object
                  provision:
                    description: OperationMetric contains metadata about an operation
                      (inspection, provisioning, etc.) used for tracking metrics.
                    properties:
                      end:
                        format: date-time
                        nullable: true
                        type: string
                      start:
                        format: date-time
                        nullable: true
                        type: string
                    type: object
                  register:
                    description: OperationMetric contains metadata about an operation
                      (inspection, provisioning, etc.) used for tracking metrics.
                    properties:
                      end:
                        format: date-time
                        nullable: true
                        type: string
                      start:
                        format: date-time
                        nullable: true
                        type: string
                    type: object
                type: object
              operationalStatus:
                description: OperationalStatus holds the status of the host
                enum:
                - ""
                - OK
                - discovered
                - error
                - delayed
                - detached
                type: string
              poweredOn:
                description: indicator for whether or not the host is powered on
                type: boolean
              provisioning:
                description: Information tracked by the provisioner.
                properties:
                  ID:
                    description: The machine's UUID from the underlying provisioning
                      tool
                    type: string
                  bootMode:
                    description: BootMode indicates the boot mode used to provision
                      the node
                    enum:
                    - UEFI
                    - UEFISecureBoot
                    - legacy
                    type: string
                  customDeploy:
                    description: Custom deploy procedure applied to the host.
                    properties:
                      method:
                        description: Custom deploy method name. This name is specific
                          to the deploy ramdisk used. If you don't have a custom deploy
                          ramdisk, you shouldn't use CustomDeploy.
                        type: string
                    required:
                    - method
                    type: object
                  firmware:
                    description: The Bios set by the user
                    properties:
                      simultaneousMultithreadingEnabled:
                        description: 'Allows a single physical processor core to appear
                          as several logical processors. This supports following options:
                          true, false.'
                        enum:
                        - true
                        - false
                        type: boolean
                      sriovEnabled:
                        description: 'SR-IOV support enables a hypervisor to create
                          virtual instances of a PCI-express device, potentially increasing
                          performance. This supports following options: true, false.'
                        enum:
                        - true
                        - false
                        type: boolean
                      virtualizationEnabled:
                        description: 'Supports the virtualization of platform hardware.
                          This supports following options: true, false.'
                        enum:
                        - true
                        - false
                        type: boolean
                    type: object
                  image:
                    description: Image holds the details of the last image successfully
                      provisioned to the host.
                    properties:
                      checksum:
                        description: Checksum is the checksum for the image.
                        type: string
                      checksumType:
                        description: ChecksumType is the checksum algorithm for the
                          image. e.g md5, sha256, sha512
                        enum:
                        - md5
                        - sha256
                        - sha512
                        type: string
                      format:
                        description: DiskFormat contains the format of the image (raw,
                          qcow2, ...). Needs to be set to raw for raw images streaming.
                          Note live-iso means an iso referenced by the url will be
                          live-booted and not deployed to disk, and in this case the
                          checksum options are not required and if specified will
                          be ignored.
                        enum:
                        - raw
                        - qcow2
                        - vdi
                        - vmdk
                        - live-iso
                        type: string
                      url:
                        description: URL is a location of an image to deploy.
                        type: string
                    required:
                    - url
                    type: object
                  raid:
                    description: The Raid set by the user
                    properties:
                      hardwareRAIDVolumes:
                        description: The list of logical disks for hardware RAID,
                          if rootDeviceHints isn't used, first volume is root volume.
                          You can set the value of this field to `[]` to clear all
                          the hardware RAID configurations.
                        items:
                          description: HardwareRAIDVolume defines the desired configuration
                            of volume in hardware RAID
                          properties:
                            controller:
                              description: The name of the RAID controller to use
                              type: string
                            level:
                              description: 'RAID level for the logical disk. The following
                                levels are supported: 0;1;2;5;6;1+0;5+0;6+0.'
                              enum:
                              - "0"
                              - "1"
                              - "2"
                              - "5"
                              - "6"
                              - 1+0
                              - 5+0
                              - 6+0
                              type: string
                            name:
                              description: Name of the volume. Should be unique within
                                the Node. If not specified, volume name will be auto-generated.
                              maxLength: 64
                              type: string
                            numberOfPhysicalDisks:
                              description: Integer, number of physical disks to use
                                for the logical disk. Defaults to minimum number of
                                disks required for the particular RAID level.
                              minimum: 1
                              type: integer
                            physicalDisks:
                              description: Optional list of physical disk names to
                                be used for the Hardware RAID volumes. The disk names
                                are interpreted by the Hardware RAID controller, and
                                the format is hardware specific.
                              items:
                                type: string
                              type: array
                            rotational:
                              description: Select disks with only rotational or solid-state
                                storage
                              type: boolean
                            sizeGibibytes:
                              description: Size (Integer) of the logical disk to be
                                created in GiB. If unspecified or set be 0, the maximum
                                capacity of disk will be used for logical disk.
                              minimum: 0
                              type: integer
                          required:
                          - level
                          type: object
                        nullable: true
                        type: array
                      softwareRAIDVolumes:
                        description: The list of logical disks for software RAID,
                          if rootDeviceHints isn't used, first volume is root volume.
                          If HardwareRAIDVolumes is set this item will be invalid.
                          The number of created Software RAID devices must be 1 or
                          2. If there is only one Software RAID device, it has to
                          be a RAID-1. If there are two, the first one has to be a
                          RAID-1, while the RAID level for the second one can be 0,
                          1, or 1+0. As the first RAID device will be the deployment
                          device, enforcing a RAID-1 reduces the risk of ending up
                          with a non-booting node in case of a disk failure. Software
                          RAID will always be deleted.
                        items:
                          description: SoftwareRAIDVolume defines the desired configuration
                            of volume in software RAID
                          properties:
                            level:
                              description: 'RAID level for the logical disk. The following
                                levels are supported: 0;1;1+0.'
                              enum:
                              - "0"
                              - "1"
                              - 1+0
                              type: string
                            physicalDisks:
                              description: A list of device hints, the number of items
                                should be greater than or equal to 2.
                              items:
                                description: RootDeviceHints holds the hints for specifying
                                  the storage location for the root filesystem for
                                  the image.
                                properties:
                                  deviceName:
                                    description: A Linux device name like "/dev/vda".
                                      The hint must match the actual value exactly.
                                    type: string
                                  hctl:
                                    description: A SCSI bus address like 0:0:0:0.
                                      The hint must match the actual value exactly.
                                    type: string
                                  minSizeGigabytes:
                                    description: The minimum size of the device in
                                      Gigabytes.
                                    minimum: 0
                                    type: integer
                                  model:
                                    description: A vendor-specific device identifier.
                                      The hint can be a substring of the actual value.
                                    type: string
                                  rotational:
                                    description: True if the device should use spinning
                                      media, false otherwise.
                                    type: boolean
                                  serialNumber:
                                    description: Device serial number. The hint must
                                      match the actual value exactly.
                                    type: string
                                  vendor:
                                    description: The name of the vendor or manufacturer
                                      of the device. The hint can be a substring of
                                      the actual value.
                                    type: string
                                  wwn:
                                    description: Unique storage identifier. The hint
                                      must match the actual value exactly.
                                    type: string
                                  wwnVendorExtension:
                                    description: Unique vendor storage identifier.
                                      The hint must match the actual value exactly.
                                    type: string
                                  wwnWithExtension:
                                    description: Unique storage identifier with the
                                      vendor extension appended. The hint must match
                                      the actual value exactly.
                                    type: string
                                type: object
                              minItems: 2
                              type: array
                            sizeGibibytes:
                              description: Size (Integer) of the logical disk to be
                                created in GiB. If unspecified or set be 0, the maximum
                                capacity of disk will be used for logical disk.
                              minimum: 0
                              type: integer
                          required:
                          - level
                          type: object
                        maxItems: 2
                        nullable: true
                        type: array
                    type: object
                  rootDeviceHints:
                    description: The RootDevicehints set by the user
                    properties:
                      deviceName:
                        description: A Linux device name like "/dev/vda". The hint
                          must match the actual value exactly.
                        type: string
                      hctl:
                        description: A SCSI bus address like 0:0:0:0. The hint must
                          match the actual value exactly.
                        type: string
                      minSizeGigabytes:
                        description: The minimum size of the device in Gigabytes.
                        minimum: 0
                        type: integer
                      model:
                        description: A vendor-specific device identifier. The hint
                          can be a substring of the actual value.
                        type: string
                      rotational:
                        description: True if the device should use spinning media,
                          false otherwise.
                        type: boolean
                      serialNumber:
                        description: Device serial number. The hint must match the
                          actual value exactly.
                        type: string
                      vendor:
                        description: The name of the vendor or manufacturer of the
                          device. The hint can be a substring of the actual value.
                        type: string
                      wwn:
                        description: Unique storage identifier. The hint must match
                          the actual value exactly.
                        type: string
                      wwnVendorExtension:
                        description: Unique vendor storage identifier. The hint must
                          match the actual value exactly.
                        type: string
                      wwnWithExtension:
                        description: Unique storage identifier with the vendor extension
                          appended. The hint must match the actual value exactly.
                        type: string
                    type: object
                  state:
                    description: An indiciator for what the provisioner is doing with
                      the host.
                    type: string
                required:
                - ID
                - state
                type: object
              triedCredentials:
                description: the last credentials we sent to the provisioning backend
                properties:
                  credentials:
                    description: SecretReference represents a Secret Reference. It
                      has enough information to retrieve secret in any namespace
                    properties:
                      name:
                        description: Name is unique within a namespace to reference
                          a secret resource.
                        type: string
                      namespace:
                        description: Namespace defines the space within which the
                          secret name must be unique.
                        type: string
                    type: object
                  credentialsVersion:
                    type: string
                type: object
            required:
            - errorCount
            - errorMessage
            - hardwareProfile
            - operationalStatus
            - poweredOn
            - provisioning
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
# The following patch enables a conversion webhook for the CRD
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: baremetalhosts.metal3.io
spec:
  conversion:
    strategy: Webhook
    webhook:
      clientConfig:
        service:
          namespace: system
          name: webhook-service
          path: /convert
        caBundle: Cg==
      conversionReviewVersions:
      - v1
---
# The following patch enables a conversion webhook for the CRD
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: bmceventsubscriptions.metal3.io
spec:
  conversion:
    strategy: Webhook
    webhook:
      clientConfig:
        service:
          namespace: system
          name: webhook-service
          path: /convert
---
# The following patch enables conversion webhook for CRD
# CRD conversion requires k8s 1.13 or later.
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: firmwareschemas.metal3.io
spec:
  conversion:
    strategy: Webhook
    webhook:
      clientConfig:
        service:      
          namespace: system
          name: webhook-service
          path: /convert
        caBundle: Cg==
      conversionReviewVersions:
      - v1
---
# The following patch adds a directive for certmanager to inject CA into the CRD
# CRD conversion requires k8s 1.13 or later.
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    cert-manager.io/inject-ca-from: $(CERTIFICATE_NAMESPACE)/$(CERTIFICATE_NAME)
  name: hostfirmwaresettings.metal3.io
---
# The following patch enables conversion webhook for CRD
# CRD conversion requires k8s 1.13 or later.
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: hostfirmwaresettings.metal3.io
spec:
  conversion:
    strategy: Webhook
    webhook:
      clientConfig:
        service:
          namespace: system
          name: webhook-service
          path: /convert
        caBundle: Cg==
      conversionReviewVersions:
      - v1
      
---
# The following patch enables conversion webhook for CRD
# CRD conversion requires k8s 1.13 or later.
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: preprovisioningimages.metal3.io
spec:
  conversion:
    strategy: Webhook
    webhook:
      clientConfig:
        service:
          namespace: system
          name: webhook-service
          path: /convert
        caBundle: Cg==
      conversionReviewVersions:
      - v1
---
# The following patch adds a directive for certmanager to inject CA into the CRD
# CRD conversion requires k8s 1.13 or later.
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    cert-manager.io/inject-ca-from: $(CERTIFICATE_NAMESPACE)/$(CERTIFICATE_NAME)
  name: preprovisioningimages.metal3.io
---
# The following patch adds a directive for certmanager to inject CA into the CRD
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    cert-manager.io/inject-ca-from: $(CERTIFICATE_NAMESPACE)/$(CERTIFICATE_NAME)
  name: bmceventsubscriptions.metal3.io
---
# The following patch adds a directive for certmanager to inject CA into the CRD
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    cert-manager.io/inject-ca-from: $(CERTIFICATE_NAMESPACE)/$(CERTIFICATE_NAME)
  name: baremetalhosts.metal3.io
---
# The following patch adds a directive for certmanager to inject CA into the CRD
# CRD conversion requires k8s 1.13 or later.
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    cert-manager.io/inject-ca-from: $(CERTIFICATE_NAMESPACE)/$(CERTIFICATE_NAME)
  name: firmwareschemas.metal3.io
---
# This kustomization.yaml is not intended to be run by itself,
# since it depends on service name and namespace that are out of this kustomize package.
# It should be run by config/default
resources:
- bases/metal3.io_baremetalhosts.yaml
- bases/metal3.io_hostfirmwaresettings.yaml
- bases/metal3.io_firmwareschemas.yaml
- bases/metal3.io_preprovisioningimages.yaml
- bases/metal3.io_bmceventsubscriptions.yaml
#+kubebuilder:scaffold:crdkustomizeresource

patchesStrategicMerge:
# [WEBHOOK] To enable webhook, uncomment all the sections with [WEBHOOK] prefix.
# patches here are for enabling the conversion webhook for each CRD
#- patches/webhook_in_baremetalhosts.yaml
#- patches/webhook_in_hostfirmwaresettings.yaml
#- patches/webhook_in_firmwareschemas.yaml
#- patches/webhook_in_preprovisioningimages.yaml
#- patches/webhook_in_bmceventsubscriptions.yaml
#+kubebuilder:scaffold:crdkustomizewebhookpatch

# [CERTMANAGER] To enable webhook, uncomment all the sections with [CERTMANAGER] prefix.
# patches here are for enabling the CA injection for each CRD
- patches/cainjection_in_baremetalhosts.yaml
#- patches/cainjection_in_hostfirmwaresettings.yaml
#- patches/cainjection_in_firmwareschemas.yaml
#- patches/cainjection_in_preprovisioningimages.yaml
#- patches/cainjection_in_bmceventsubscriptions.yaml
#+kubebuilder:scaffold:crdkustomizecainjectionpatch

# the following config is for teaching kustomize how to do kustomization for CRDs.
configurations:
- kustomizeconfig.yaml
---
# This file is for teaching kustomize how to substitute name and namespace reference in CRD
nameReference:
- kind: Service
  version: v1
  fieldSpecs:
  - kind: CustomResourceDefinition
    version: v1
    group: apiextensions.k8s.io
    path: spec/conversion/webhook/clientConfig/service/name

namespace:
- kind: CustomResourceDefinition
  version: v1
  group: apiextensions.k8s.io
  path: spec/conversion/webhook/clientConfig/service/namespace
  create: false

varReference:
- path: metadata/annotations
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: controller-manager
  namespace: system
spec:
  template:
    spec:
      containers:
      - name: manager
        volumeMounts:
        - name: ironic-credentials
          mountPath: "/opt/metal3/auth/ironic"
          readOnly: true
        - name: ironic-inspector-credentials
          mountPath: "/opt/metal3/auth/ironic-inspector"
          readOnly: true
      volumes:
      - name: ironic-credentials
        secret:
          secretName: ironic-credentials
      - name: ironic-inspector-credentials
        secret:
          secretName: ironic-inspector-credentials
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: baremetal-operator-system
resources:
- ../../default
- ../../namespace

secretGenerator:
  - name: ironic-credentials
    files:
    - username=ironic-username
    - password=ironic-password
  - name: ironic-inspector-credentials
    files:
    - username=ironic-inspector-username
    - password=ironic-inspector-password

patchesStrategicMerge:
- credentials_patch.yaml---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: controller-manager
  namespace: system
spec:
  template:
    spec:
      containers:
      - name: manager
        volumeMounts:
        - name: ironic-credentials
          mountPath: "/opt/metal3/auth/ironic"
          readOnly: true
        - name: ironic-inspector-credentials
          mountPath: "/opt/metal3/auth/ironic-inspector"
          readOnly: true
      volumes:
      - name: ironic-credentials
        secret:
          secretName: ironic-credentials
      - name: ironic-inspector-credentials
        secret:
          secretName: ironic-inspector-credentials
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: baremetal-operator-system
resources:
- ../../tls

secretGenerator:
  - name: ironic-credentials
    files:
    - username=ironic-username
    - password=ironic-password
  - name: ironic-inspector-credentials
    files:
    - username=ironic-inspector-username
    - password=ironic-inspector-password

patchesStrategicMerge:
- credentials_patch.yaml